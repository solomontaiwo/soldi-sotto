import{P as c,u as S,a as q,b as O,j as e,B as k,F as I,R as P,c as z,d as B,r as m,e as F,f as L,g as Q,h as $}from"./index-DVNr0Sae.js";import{T as U}from"./TransactionModal-E0wlfX_i.js";import{C as u,a as g,b as f,c as v,d as N}from"./card-D_gtHubT.js";import{S as i,f as j,g as _,c as H}from"./statsUtils-CUIURLah.js";import"./categories-C8NGgGe-.js";import"./label-DmEWnETg.js";const E=({transactions:h=[],loading:p=!1})=>{E.propTypes={transactions:c.arrayOf(c.shape({id:c.string.isRequired,description:c.string.isRequired,amount:c.number.isRequired,type:c.oneOf(["income","expense"]).isRequired,date:c.object.isRequired,category:c.string})),loading:c.bool};const o=S(),x=q({maxWidth:768}),{t:l}=O(),r=[...h].sort((t,n)=>{const b=t.date?.toDate?t.date.toDate():new Date(t.date);return(n.date?.toDate?n.date.toDate():new Date(n.date)).getTime()-b.getTime()}).slice(0,5),y=t=>(t.toDate?t.toDate():new Date(t)).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"}),R=t=>t?l("categories."+t)||t:"";return p?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((t,n)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{circle:!0,width:40,height:40}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{height:16,width:120}),e.jsx(i,{height:12,width:80})]}),e.jsx(i,{height:18,width:60})]},n))}):r.length===0?e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("p",{className:"text-muted-foreground",children:l("recentTransactions.emptyDescription")}),e.jsx(k,{onClick:()=>o("/transactions"),size:x?"sm":"default",children:l("recentTransactions.addFirst")})]}):e.jsxs("div",{className:"space-y-3",children:[r.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-border bg-card/70 p-3 shadow-sm",onClick:()=>o("/transactions"),children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:t.description}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx("span",{children:y(t.date)}),t.category&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"capitalize",children:R(t.category)})]})]})]})}),e.jsxs("div",{className:`text-sm font-semibold ${t.type==="income"?"text-emerald-600":"text-rose-600"}`,children:[t.type==="income"?"+":"-",j(t.amount)]})]},t.id)),e.jsx("div",{className:"flex justify-end",children:e.jsxs(k,{variant:"ghost",size:"sm",onClick:()=>o("/transactions"),className:"gap-1 text-primary",children:[l("recentTransactions.viewAll"),e.jsx(I,{className:"h-4 w-4"})]})})]})},J=()=>{const h=S(),{currentUser:p}=z(),{transactions:o,isDemo:x,canAddMoreTransactions:l,loading:r,fetchAllTransactions:y}=B(),[R,t]=m.useState(!1),[n,b]=m.useState([]),{t:s}=O();m.useEffect(()=>{(async()=>{if(x)b(o);else if(p){const C=await y();b(C)}})()},[x,o,p,y]);const w=m.useMemo(()=>{const a=localStorage.getItem("analytics-period");if(a)try{return JSON.parse(a)}catch{return{period:"monthly"}}return{period:"monthly"}},[]),{start:T,end:D}=_(w.period||"monthly",w.customRange),A=m.useMemo(()=>n.filter(a=>{const C=a.date;return C>=T&&C<=D}),[n,T,D]),d=m.useMemo(()=>r?null:A.length?H(A,T,D):{totalIncome:0,totalExpense:0,balance:0},[A,T,D,r]),M=m.useMemo(()=>[{key:"add-transaction",title:s("addTransaction"),subtitle:s("whatToRegister"),icon:e.jsx(F,{}),action:()=>t(!0),disabled:x&&!l},{key:"view-transactions",title:s("manageAll"),subtitle:s("yourTransactions"),icon:e.jsx(L,{}),action:()=>h("/transactions")},{key:"view-analytics",title:s("navbar.analytics"),subtitle:s("landing.mainFeatures"),icon:e.jsx(Q,{}),action:()=>h("/analytics")}],[x,l,h,s]);return e.jsxs("div",{className:"page-shell",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between rounded-2xl border border-border bg-card/70 p-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Soldi Sotto"}),e.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-2",children:["ðŸ‘‹"," ",s("welcome")]}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-2xl",children:s("motivationalQuote")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-3",children:[e.jsxs(k,{variant:"outline",size:"lg",onClick:()=>h("/analytics"),className:"gap-2 px-4",children:[e.jsx($,{className:"h-4 w-4"}),s("navbar.analytics")]}),e.jsxs(k,{size:"lg",onClick:()=>t(!0),disabled:x&&!l,className:"gap-2 px-4",children:[e.jsx(F,{className:"h-4 w-4"})," ",s("addTransaction")]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(u,{className:"glass",children:[e.jsxs(g,{children:[e.jsx(f,{children:s("financialOverview.balance")}),e.jsx(v,{children:s("financialOverview.totalTransactions")})]}),e.jsx(N,{children:r||!d?e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{height:36,width:"60%"}),e.jsx(i,{height:20,width:"40%"}),e.jsx(i,{height:20,width:"40%"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-3xl font-bold text-primary",children:j(d.balance||0)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s("financialOverview.totalIncome"),": ",j(d.totalIncome||0)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s("financialOverview.totalExpense"),": ",j(d.totalExpense||0)]})]})})]}),e.jsxs(u,{className:"glass",children:[e.jsxs(g,{children:[e.jsx(f,{children:s("financialOverview.totalIncome")}),e.jsx(v,{children:s(`periods.${w.period}`)})]}),e.jsx(N,{children:r||!d?e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{height:36,width:"50%"}),e.jsx(i,{height:20,width:"30%"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-3xl font-bold text-emerald-600",children:j(d.totalIncome||0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("recentTransactions.title")})]})})]}),e.jsxs(u,{className:"glass",children:[e.jsxs(g,{children:[e.jsx(f,{children:s("financialOverview.totalExpense")}),e.jsx(v,{children:s(`periods.${w.period}`)})]}),e.jsx(N,{children:r||!d?e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{height:36,width:"50%"}),e.jsx(i,{height:20,width:"30%"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-3xl font-bold text-rose-600",children:j(d.totalExpense||0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("recentTransactions.title")})]})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[e.jsxs(u,{className:"lg:col-span-2 glass",children:[e.jsxs(g,{children:[e.jsx(f,{children:s("quickActions")}),e.jsx(v,{children:s("whatToRegister")})]}),e.jsx(N,{className:"grid gap-3 md:grid-cols-3",children:M.map(a=>e.jsxs("button",{onClick:()=>!a.disabled&&a.action(),className:`flex items-center gap-3 rounded-xl border border-border bg-card/80 p-4 text-left shadow-sm transition hover:-translate-y-1 hover:shadow-lg ${a.disabled?"opacity-60 cursor-not-allowed":""}`,children:[e.jsx("span",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary",children:a.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:a.title}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.subtitle})]})]},a.key))})]}),e.jsxs(u,{className:"glass",children:[e.jsxs(g,{children:[e.jsx(f,{children:s("recentTransactions.title")}),e.jsx(v,{children:s("recentTransactions.viewAll")})]}),e.jsx(N,{children:e.jsx(E,{transactions:o,loading:r})})]})]}),e.jsx(U,{show:R,onClose:()=>t(!1),transaction:null})]})},Z=P.memo(J);export{Z as default};
