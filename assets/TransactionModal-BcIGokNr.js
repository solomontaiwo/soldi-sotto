import{P as f,k as W,z as E,d as I,r as p,e as q,j as e,m as B,f as m,h as P,g as G,C as H,l as O}from"./index-BsuRMmVW.js";import{u as V}from"./categories-DbXDQrsJ.js";import{S as d}from"./formatCurrency-ChWFhNJW.js";import{M as C}from"./Modal-DbNhBklx.js";import{F as o}from"./Form-DB0IUDCf.js";import{R as U}from"./Row-6nD61_uA.js";import{C as T}from"./Col-BeTjwsmv.js";const A=({show:c,onClose:x,onSubmit:b,transaction:s})=>{A.propTypes={show:f.bool.isRequired,onClose:f.func.isRequired,onSubmit:f.func,transaction:f.object};const l=!!s,{addTransaction:z,updateTransaction:R}=W(),{expenseCategories:h,incomeCategories:j}=V(),k=E(),v=I({maxWidth:768}),[D,F]=p.useState([]),[N,w]=p.useState(!1),{t:r}=q(),[a,u]=p.useState({type:s?.type||"expense",amount:s?.amount?.toString()||"",description:s?.description||"",date:s?.date?(s.date instanceof Date?s.date:s.date?.toDate?.()||new Date(s.date)).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],category:s?.category||""}),S=p.useCallback(t=>{const n=t==="expense"?h:j;F(n),(!a.category||!n.find(i=>i.value===a.category))&&u(i=>({...i,category:n[0]?.value||""}))},[h,j,a.category]);p.useEffect(()=>{S(a.type)},[a.type,h,j]),p.useEffect(()=>{c&&!l&&u({type:"expense",amount:"",description:"",date:new Date().toISOString().split("T")[0],category:h[0]?.value||""}),c&&l&&s&&u({type:s.type,amount:s.amount.toString(),description:s.description,date:(s.date instanceof Date?s.date:s.date?.toDate?.()||new Date(s.date)).toISOString().split("T")[0],category:s.category})},[c,l,s]);const L=async t=>{t.preventDefault(),w(!0);try{const n=a.amount.replace(",","."),i=parseFloat(n);if(isNaN(i)||i<=0){k.error("Inserisci un importo valido"),w(!1);return}let y=!1;l?y=await(b?b(a):R(s.id,{type:a.type,amount:i,description:a.description,date:new Date(a.date),category:a.category})):y=await(b?b(a):z({type:a.type,amount:i,description:a.description,date:new Date(a.date),category:a.category})),y&&x()}catch{k.error("Errore nella transazione")}finally{w(!1)}},g=(t,n)=>{u(i=>({...i,[t]:n}))},M=t=>{u(n=>({...n,type:t})),S(t)};return c?N?e.jsx(C,{show:c,onHide:x,centered:!0,size:"lg",backdrop:!0,className:"glass-modal",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{height:24,width:180,style:{marginBottom:12}}),e.jsx(d,{height:18,width:120})]}),e.jsx("div",{className:"mb-3",children:e.jsx(d,{height:40,width:"100%",style:{borderRadius:12}})}),e.jsx("div",{className:"mb-3",children:e.jsx(d,{height:40,width:"100%",style:{borderRadius:12}})}),e.jsx("div",{className:"mb-3",children:e.jsx(d,{height:40,width:"100%",style:{borderRadius:12}})}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(d,{height:38,width:120,style:{borderRadius:20}}),e.jsx(d,{height:38,width:180,style:{borderRadius:20}})]})]})}):e.jsx(C,{show:c,onHide:x,centered:!0,size:"lg",backdrop:!0,className:"glass-modal",style:{},children:e.jsxs(B.div,{initial:{opacity:0,scale:.98,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.98,y:10},transition:{type:"spring",damping:28,stiffness:320,duration:.32},style:{background:document.documentElement.classList.contains("dark-theme")?"rgba(30,41,59,0.98)":"rgba(255,255,255,0.92)",backdropFilter:"blur(32px)",WebkitBackdropFilter:"blur(32px)",borderRadius:"28px",border:document.documentElement.classList.contains("dark-theme")?"1.5px solid #334155":"1px solid #e5e7eb",boxShadow:"0 8px 32px rgba(0,0,0,0.10)",width:"auto",maxHeight:"90vh",overflow:"hidden",position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-4 pb-0 w-100",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"fw-bold text-dark mb-1 d-flex align-items-center gap-3",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 197, 253, 0.15))",backdropFilter:"blur(10px)",border:"1px solid rgba(59, 130, 246, 0.2)"},children:l?"✏️":"⚡"}),r(l?"transactionModal.editTitle":"transactionModal.newTitle")]}),e.jsx("p",{className:"text-muted mb-0 ms-5 ps-3",style:{fontSize:"0.95rem"},children:r(l?"transactionModal.editSubtitle":"transactionModal.newSubtitle")})]}),e.jsx(m,{variant:"link",onClick:x,className:"p-0 d-flex align-items-center justify-content-center",style:{fontSize:"22px",width:"44px",height:"44px",borderRadius:"16px",background:"var(--glass-bg, rgba(255,255,255,0.6))",color:"var(--text-primary, #222)",border:"1px solid rgba(0, 0, 0, 0.08)",transition:"all 0.3s ease"},onMouseEnter:t=>{t.currentTarget.style.background="rgba(239, 68, 68, 0.15)",t.currentTarget.style.color="#dc3545",t.currentTarget.style.transform="scale(1.05)"},onMouseLeave:t=>{t.currentTarget.style.background="var(--glass-bg, rgba(255,255,255,0.6))",t.currentTarget.style.color="var(--text-primary, #222)",t.currentTarget.style.transform="scale(1)"},children:e.jsx("span",{style:{color:"inherit",fontWeight:700},children:"×"})})]}),e.jsxs("div",{className:"p-4 pt-3 w-100",style:{maxHeight:"calc(90vh - 120px)",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"rgba(0,0,0,0.2) transparent"},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(o.Label,{className:"fw-semibold text-dark mb-2 small",children:r("transactionModal.type")}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(m,{variant:a.type==="expense"?"danger":"outline-danger",onClick:()=>M("expense"),className:"flex-fill d-flex align-items-center justify-content-center gap-2 py-2",style:{borderRadius:"12px",fontWeight:"600",fontSize:"14px",background:a.type==="expense"?"linear-gradient(135deg, var(--accent-error), #c82333)":"rgba(255, 255, 255, 0.8)",border:a.type==="expense"?"none":"2px solid var(--accent-error)"},children:[e.jsx(P,{size:16}),r("transactionModal.expense")]}),e.jsxs(m,{variant:a.type==="income"?"success":"outline-success",onClick:()=>M("income"),className:"flex-fill d-flex align-items-center justify-content-center gap-2 py-2",style:{borderRadius:"12px",fontWeight:"600",fontSize:"14px",background:a.type==="income"?"linear-gradient(135deg, var(--accent-success), #157347)":"rgba(255, 255, 255, 0.8)",border:a.type==="income"?"none":"2px solid var(--accent-success)"},children:[e.jsx(G,{size:16}),r("transactionModal.income")]})]})]}),e.jsxs(o,{onSubmit:L,children:[e.jsxs(U,{className:"mb-3",children:[e.jsx(T,{xs:v?12:6,className:v?"mb-3":"",children:e.jsxs(o.Group,{children:[e.jsx(o.Label,{className:"fw-semibold text-dark small mb-1",children:r("transactionModal.amount")}),e.jsx(o.Control,{type:"text",inputMode:"decimal",placeholder:r("transactionModal.amountPlaceholder"),value:a.amount,onChange:t=>{const i=t.target.value.replace(/[^0-9.,]/g,"");i.split(/[,.]/).length<=2&&g("amount",i)},onBlur:t=>{const n=t.target.value;if(n&&n.includes(",")){const i=n.replace(",",".");g("amount",i)}},required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"}})]})}),e.jsx(T,{xs:v?12:6,children:e.jsxs(o.Group,{children:[e.jsx(o.Label,{className:"fw-semibold text-dark small mb-1",children:r("transactionModal.date")}),e.jsx(o.Control,{type:"date",value:a.date,onChange:t=>g("date",t.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"}})]})})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{className:"fw-semibold text-dark small mb-1",children:r("transactionModal.description")}),e.jsx(o.Control,{type:"text",placeholder:r("transactionModal.descriptionPlaceholder"),value:a.description,onChange:t=>g("description",t.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"}})]}),e.jsxs(o.Group,{className:"mb-4",children:[e.jsx(o.Label,{className:"fw-semibold text-dark small mb-2",children:r("transactionModal.category")}),e.jsxs(o.Select,{value:a.category,onChange:t=>g("category",t.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"},children:[e.jsx("option",{value:"",children:r("transactionModal.selectCategory")}),D.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(m,{type:"button",variant:"outline-secondary",onClick:x,className:"flex-fill py-2",style:{borderRadius:"12px",fontWeight:"500",fontSize:"14px",background:"rgba(255, 255, 255, 0.9)",border:"1px solid rgba(0, 0, 0, 0.15)"},children:r("transactionModal.cancel")}),e.jsx(m,{type:"submit",disabled:N||!a.amount||!a.description||!a.category,className:"flex-fill border-0 fw-semibold py-2",style:{borderRadius:"12px",fontSize:"14px",background:a.type==="expense"?"linear-gradient(135deg, var(--accent-error), #c82333)":"linear-gradient(135deg, var(--accent-success), #157347)",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.15)"},children:N?e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),r(l?"transactionModal.saving":"transactionModal.adding")]}):e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-1",children:[l?e.jsx(H,{size:16}):e.jsx(O,{size:16}),l?r("transactionModal.saveChanges"):r("transactionModal.addButton",{type:a.type==="expense"?r("transactionModal.expense"):r("transactionModal.income")})]})})]})]})]})]})}):null};export{A as T};
