import{r as a,M as ge,j as e,C as Z,D as fe,E as be,G as ye,L as ve,s as je,t as ke,k as we,i as Ce,n as O,H as Ne,l as B,v as G,I as Se,J as De,K as Te,O as Fe}from"./index-D4QZR-z-.js";import{T as Re}from"./TransactionModal-B5hYM86Q.js";import{f as X}from"./formatCurrency-DQxE0pTn.js";import{u as ze}from"./categories-Cln8VQv8.js";import{t as Me,c as H,n as Ee,s as Q,a as We,e as Le,b as Oe,d as Be,f as Ie,g as Y}from"./format-CrPPGQr8.js";import{e as Pe,a as Ae}from"./endOfWeek-BovlL6-H.js";import{F as A}from"./Form-BwjOgBNe.js";import{A as $e}from"./Alert-CIQ6JKvU.js";import{i as He}from"./it-DBO_pyXn.js";import"./Modal-BL1hyBeY.js";import"./Col-OKItE9CD.js";import"./Row-Czfum0a6.js";class Ue extends a.Component{getSnapshotBeforeUpdate(c){const s=this.props.childRef.current;if(s&&c.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=s.offsetHeight||0,o.width=s.offsetWidth||0,o.top=s.offsetTop,o.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Ke({children:n,isPresent:c}){const s=a.useId(),o=a.useRef(null),k=a.useRef({width:0,height:0,top:0,left:0}),{nonce:b}=a.useContext(ge);return a.useInsertionEffect(()=>{const{width:y,height:u,top:C,left:p}=k.current;if(c||!o.current||!y||!u)return;o.current.dataset.motionPopId=s;const m=document.createElement("style");return b&&(m.nonce=b),document.head.appendChild(m),m.sheet&&m.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${y}px !important;
            height: ${u}px !important;
            top: ${C}px !important;
            left: ${p}px !important;
          }
        `),()=>{document.head.removeChild(m)}},[c]),e.jsx(Ue,{isPresent:c,childRef:o,sizeRef:k,children:a.cloneElement(n,{ref:o})})}const Qe=({children:n,initial:c,isPresent:s,onExitComplete:o,custom:k,presenceAffectsLayout:b,mode:y})=>{const u=Z(_e),C=a.useId(),p=a.useCallback(N=>{u.set(N,!0);for(const D of u.values())if(!D)return;o&&o()},[u,o]),m=a.useMemo(()=>({id:C,initial:c,isPresent:s,custom:k,onExitComplete:p,register:N=>(u.set(N,!1),()=>u.delete(N))}),b?[Math.random(),p]:[s,p]);return a.useMemo(()=>{u.forEach((N,D)=>u.set(D,!1))},[s]),a.useEffect(()=>{!s&&!u.size&&o&&o()},[s]),y==="popLayout"&&(n=e.jsx(Ke,{isPresent:s,children:n})),e.jsx(fe.Provider,{value:m,children:n})};function _e(){return new Map}const $=n=>n.key||"";function J(n){const c=[];return a.Children.forEach(n,s=>{a.isValidElement(s)&&c.push(s)}),c}const V=({children:n,custom:c,initial:s=!0,onExitComplete:o,presenceAffectsLayout:k=!0,mode:b="sync",propagate:y=!1})=>{const[u,C]=be(y),p=a.useMemo(()=>J(n),[n]),m=y&&!u?[]:p.map($),N=a.useRef(!0),D=a.useRef(p),T=Z(()=>new Map),[v,z]=a.useState(p),[w,I]=a.useState(p);ye(()=>{N.current=!1,D.current=p;for(let j=0;j<w.length;j++){const x=$(w[j]);m.includes(x)?T.delete(x):T.get(x)!==!0&&T.set(x,!1)}},[w,m.length,m.join("-")]);const S=[];if(p!==v){let j=[...p];for(let x=0;x<w.length;x++){const h=w[x],E=$(h);m.includes(E)||(j.splice(x,0,h),S.push(h))}b==="wait"&&S.length&&(j=S),I(J(j)),z(p);return}const{forceRender:M}=a.useContext(ve);return e.jsx(e.Fragment,{children:w.map(j=>{const x=$(j),h=y&&!u?!1:p===w||m.includes(x),E=()=>{if(T.has(x))T.set(x,!0);else return;let F=!0;T.forEach(U=>{U||(F=!1)}),F&&(M?.(),I(D.current),y&&C?.(),o&&o())};return e.jsx(Qe,{isPresent:h,initial:!N.current||s?void 0:!1,custom:h?void 0:c,presenceAffectsLayout:k,mode:b,onExitComplete:h?void 0:E,children:j},x)})})};function qe(n,c,s){const o=Me(n,s?.in);return isNaN(c)?H(n,NaN):(o.setDate(o.getDate()+c),o)}function ee(n){return H(n,Date.now())}function te(n,c,s){const[o,k]=Ee(s?.in,n,c);return+Q(o)==+Q(k)}function Ge(n,c){return te(H(n,n),ee(n))}function Xe(n,c,s){return qe(n,-1,s)}function Ye(n,c){return te(H(n,n),Xe(ee(n)))}const dt=()=>{const{currentUser:n,loading:c}=je(),{transactions:s,loading:o,deleteTransaction:k,isDemo:b,canAddMoreTransactions:y,maxTransactions:u}=ke(),{expenseCategories:C,incomeCategories:p}=ze(),[m,N]=a.useState([]),[D,T]=a.useState(null),[v,z]=a.useState(null),[w,I]=a.useState("monthly"),[S,M]=a.useState(""),[j,x]=a.useState(!1),[h,E]=a.useState(!1),[F,U]=a.useState("all"),[W,se]=a.useState("all"),{t:l}=we(),r=Ce({maxWidth:768}),ae=c||o,L=a.useMemo(()=>l("dashboard.motivationalQuotes",{returnObjects:!0}),[l]),[re,ie]=a.useState("");a.useEffect(()=>{L&&L.length>0&&ie(L[Math.floor(Math.random()*L.length)])},[L]);const _=t=>Ge(t)?l("transactions.today"):Ye(t)?l("transactions.yesterday"):Y(t,"dd MMMM yyyy",{locale:He}),R=t=>t.date?.toDate?t.date.toDate():t.date?.seconds?new Date(t.date.seconds*1e3):t.date instanceof Date?t.date:new Date(t.date),ne=t=>{const g={};return t.forEach(i=>{const f=R(i),d=Y(f,"yyyy-MM-dd");g[d]||(g[d]={date:f,displayDate:_(f),transactions:[]}),g[d].transactions.push(i)}),Object.values(g).sort((i,f)=>f.date-i.date)},le=t=>{const i=[...C,...p].find(f=>f.value===t);return i?i.label.split(" ")[0]:"ðŸ’¸"},K=t=>{const i=[...C,...p].find(f=>f.value===t);return i?i.label:t};a.useEffect(()=>{if(s.length>0){const t=new Date;let g,i;switch(w){case"weekly":g=Ie(t,{weekStartsOn:1}),i=Ae(t,{weekStartsOn:1});break;case"daily":g=Q(t),i=Pe(t);break;case"annually":g=Oe(t),i=Be(t);break;case"all":g=new Date(0),i=new Date;break;case"monthly":default:g=We(t),i=Le(t);break}let f=s.filter(d=>{const P=R(d),xe=P>=g&&P<=i,me=S===""||d.description.toLowerCase().includes(S.toLowerCase())||d.category.toLowerCase().includes(S.toLowerCase()),ue=F==="all"||d.category===F,he=W==="all"||d.type===W;return xe&&me&&ue&&he});f.sort((d,P)=>R(P)-R(d)),N(f)}},[s,w,S,F,W]);const oe=a.useCallback(async t=>{z(t)},[]),de=a.useCallback(async()=>{v&&await k(v)&&z(null)},[v,k]),ce=[...new Set(s.map(t=>t.category))],pe=[{value:"daily",label:l("transactions.filters.today")},{value:"weekly",label:l("transactions.filters.week")},{value:"monthly",label:l("transactions.filters.month")},{value:"annually",label:l("transactions.filters.year")},{value:"all",label:l("transactions.filters.all")}];if(ae)return e.jsx("div",{className:"d-flex justify-content-center align-items-center vh-100",style:{background:"var(--gradient-soft-blue)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border mb-3",style:{color:"var(--primary-500)"},role:"status",children:e.jsx("span",{className:"visually-hidden",children:l("loading")})}),e.jsx("h5",{className:"text-dark",children:l("transactions.loadingTransactions")})]})});if(!n&&!b)return e.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center",style:{background:"var(--gradient-soft-blue)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"display-6 text-dark mb-3",children:l("transactions.accessRequired")}),e.jsx("p",{className:"lead text-muted",children:l("transactions.loginRequired")})]})});const q=ne(m);return e.jsxs("div",{className:"min-vh-100",style:{background:"transparent",overflowX:"hidden",WebkitOverflowScrolling:"touch"},children:[e.jsx(O.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"position-sticky top-0",style:{backgroundColor:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(25px)",WebkitBackdropFilter:"blur(25px)",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 1px 20px rgba(0, 0, 0, 0.08)",zIndex:1020,padding:"16px 0"},children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:`fw-bold text-dark mb-1 ${r?"h4":"h2"}`,children:["ðŸ’³ ",l("transactions.title")]}),e.jsx("div",{className:"text-primary fw-medium mb-2",style:{fontSize:r?"1rem":"1.15rem",opacity:.85},children:e.jsx("span",{style:{fontStyle:"italic"},children:re})}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(Ne,{className:"small",style:{backgroundColor:"rgba(255, 255, 255, 0.6)",color:"var(--text-secondary)",border:"1px solid rgba(255, 255, 255, 0.3)",backdropFilter:"blur(10px)",borderRadius:"8px"},children:m.length}),m.length!==s.length&&e.jsxs("span",{className:"text-muted small",children:[l("transactions.of")," ",s.length]})]})]}),e.jsxs(B,{variant:"primary",size:r?"sm":"md",onClick:()=>x(!0),disabled:b&&!y,className:"d-flex align-items-center gap-1",style:{background:"linear-gradient(135deg, var(--primary-500), var(--primary-600))",borderColor:"var(--primary-500)",borderRadius:"1.5rem",padding:r?"8px 16px":"12px 20px",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[e.jsx(G,{size:r?16:18}),!r&&e.jsx("span",{children:l("addTransaction")})]})]}),e.jsxs("div",{className:"position-relative mb-3",children:[e.jsx(Se,{className:"position-absolute top-50 start-0 translate-middle-y text-muted ms-3",size:18}),e.jsx(A.Control,{type:"text",className:"ps-5 border-0",placeholder:l("searchTransactions"),value:S,onChange:t=>M(t.target.value),style:{borderRadius:"1.5rem",padding:r?"12px 16px 12px 48px":"14px 16px 14px 48px",background:"rgba(255, 255, 255, 0.75)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"}})]}),e.jsxs("div",{className:`d-flex gap-2 mb-2 ${r?"flex-column":"flex-row"}`,children:[e.jsx(A.Select,{value:w,onChange:t=>I(t.target.value),className:"border-0",style:{borderRadius:"0.75rem",fontSize:r?"14px":"16px",flex:r?"none":"1",marginBottom:r?"8px":"0",background:"rgba(255, 255, 255, 0.75)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:pe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsxs(B,{variant:h?"primary":"outline-secondary",size:"sm",onClick:()=>E(!h),className:"d-flex align-items-center gap-1 px-3",style:{borderRadius:"0.75rem",background:h?"linear-gradient(135deg, var(--primary-500), var(--primary-600))":"rgba(255, 255, 255, 0.75)",borderColor:h?"var(--primary-500)":"rgba(255, 255, 255, 0.3)",color:h?"white":"var(--text-secondary)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",minWidth:r?"100%":"auto"},children:[e.jsx(De,{size:16}),!r&&l("transactions.filters.label"),r&&l(h?"transactions.filters.hide":"transactions.filters.show")]})]}),b&&e.jsx($e,{variant:"info",className:"mb-0 border-0 small",style:{background:"rgba(255, 255, 255, 0.6)",color:"var(--text-secondary)",borderRadius:"1.5rem",padding:r?"8px 12px":"12px 16px",border:"1px solid rgba(255, 255, 255, 0.3)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{children:"ðŸŽ¯"}),e.jsxs("span",{children:[e.jsx("strong",{children:l("transactions.demoMode")})," - ",s.length,"/",u," ",l("transactions.transactions")]})]})}),e.jsx(V,{children:h&&e.jsx(O.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-3",children:e.jsxs("div",{className:`${r?"d-flex flex-column gap-2":"row g-2"}`,children:[e.jsx("div",{className:r?"w-100":"col-6",children:e.jsxs(A.Select,{value:W,onChange:t=>se(t.target.value),className:"border-0 small",style:{borderRadius:"0.75rem",background:"rgba(255, 255, 255, 0.75)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:[e.jsx("option",{value:"all",children:l("transactions.filters.allTypes")}),e.jsx("option",{value:"income",children:l("income")}),e.jsx("option",{value:"expense",children:l("expense")})]})}),e.jsx("div",{className:r?"w-100":"col-6",children:e.jsxs(A.Select,{value:F,onChange:t=>U(t.target.value),className:"border-0 small",style:{borderRadius:"0.75rem",background:"rgba(255, 255, 255, 0.75)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:[e.jsx("option",{value:"all",children:"Categorie"}),ce.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]})})]})})})]})}),e.jsx("div",{className:"container",style:{paddingBottom:r?"100px":"40px",paddingTop:"20px"},children:q.length>0?e.jsx("div",{className:"mt-4",children:e.jsx(V,{children:q.map((t,g)=>e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:g*.1},className:"mb-5",children:[e.jsxs("div",{className:"d-flex align-items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex-grow-1",style:{height:"2px",background:"rgba(0, 0, 0, 0.1)",borderRadius:"1px"}}),e.jsx("span",{className:"fw-medium px-3 py-1 timeline-date-badge",style:{background:"var(--timeline-date-bg, rgba(255,255,255,0.65))",color:"var(--timeline-date-color, var(--text-secondary))",borderRadius:"1rem",fontSize:"0.875rem",border:"1px solid var(--timeline-date-border, rgba(0,0,0,0.08))",backdropFilter:"blur(8px)"},children:t.displayDate}),e.jsx("div",{className:"flex-grow-1",style:{height:"2px",background:"rgba(0, 0, 0, 0.1)",borderRadius:"1px"}})]}),e.jsx("div",{className:"d-flex flex-column gap-3",children:t.transactions.map((i,f)=>e.jsxs(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:f*.05},className:"d-flex align-items-center justify-content-between p-3 mb-2 rounded-3 transaction-card",style:{background:"rgba(255, 255, 255, 0.95)",border:"1px solid rgba(0, 0, 0, 0.08)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",cursor:"pointer",transition:"all 0.2s ease",minHeight:r?"70px":"60px"},onMouseEnter:d=>{d.currentTarget.style.background="rgba(255, 255, 255, 1)",d.currentTarget.style.transform="translateX(4px)",d.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.1)"},onMouseLeave:d=>{d.currentTarget.style.background="rgba(255, 255, 255, 0.95)",d.currentTarget.style.transform="translateX(0)",d.currentTarget.style.boxShadow=""},children:[e.jsxs("div",{className:"d-flex align-items-center gap-3 flex-grow-1",style:{minWidth:0},children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center flex-shrink-0",style:{width:r?"44px":"40px",height:r?"44px":"40px",backgroundColor:i.type==="income"?"rgba(34, 197, 94, 0.15)":"rgba(239, 68, 68, 0.15)",color:i.type==="income"?"#22c55e":"#ef4444",fontSize:r?"18px":"16px"},children:i.type==="income"?"ðŸ’°":le(i.category)}),e.jsxs("div",{className:"flex-grow-1",style:{minWidth:0,overflow:"hidden"},children:[e.jsx("div",{className:"fw-semibold text-dark mb-1",style:{fontSize:r?"15px":"14px",lineHeight:"1.3",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.description}),r?e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small mb-1",style:{fontSize:"12px"},children:R(i).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("div",{className:"text-muted small",style:{fontSize:"11px",opacity:.8},children:K(i.category)})]}):e.jsxs("div",{className:"text-muted small d-flex align-items-center gap-2",children:[e.jsx("span",{children:R(i).toLocaleDateString("it-IT")}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:K(i.category)})]})]})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"fw-bold",style:{fontSize:r?"16px":"15px",color:i.type==="income"?"#22c55e":"#ef4444",lineHeight:"1.2"},children:[i.type==="income"?"+":"-",X(i.amount)]}),r&&e.jsx("div",{className:"text-muted small",style:{fontSize:"10px"},children:R(i).toLocaleDateString("it-IT",{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx(B,{variant:"link",size:"sm",onClick:d=>{d.stopPropagation(),T(i)},className:"text-info p-1 d-flex align-items-center justify-content-center",style:{width:r?"32px":"28px",height:r?"32px":"28px",borderRadius:"8px",backgroundColor:"rgba(13, 202, 240, 0.1)",border:"1px solid rgba(13, 202, 240, 0.2)"},children:e.jsx(Te,{size:r?14:12})}),e.jsx(B,{variant:"link",size:"sm",onClick:d=>{d.stopPropagation(),oe(i.id)},className:"text-danger p-1 d-flex align-items-center justify-content-center",style:{width:r?"32px":"28px",height:r?"32px":"28px",borderRadius:"8px",backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)"},children:e.jsx(Fe,{size:r?14:12})})]})]})]},i.id))})]},t.date.toISOString()))})}):e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-5",style:{marginTop:"3rem"},children:[e.jsx("div",{className:"mx-auto mb-4 rounded-circle d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",background:"rgba(255, 255, 255, 0.65)",border:"1px solid rgba(0, 0, 0, 0.08)",backdropFilter:"blur(8px)"},children:e.jsx("span",{style:{fontSize:"3rem"},children:"ðŸ’³"})}),e.jsx("h3",{className:"text-dark fw-bold mb-2",children:l("transactions.empty.title")}),e.jsx("p",{className:"text-muted mb-4",children:l(S||F!=="all"||W!=="all"?"transactions.empty.tryFilters":"transactions.empty.addFirst")}),e.jsxs(B,{variant:"primary",size:"lg",onClick:()=>x(!0),disabled:b&&!y,className:"d-flex align-items-center gap-2 mx-auto",style:{background:"linear-gradient(135deg, var(--primary-500), var(--primary-600))",borderColor:"var(--primary-500)",borderRadius:"1.5rem",padding:"12px 24px",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},children:[e.jsx(G,{size:20}),"Aggiungi Transazione"]})]})}),e.jsx(Re,{show:j||!!D,onClose:()=>{x(!1),T(null)},transaction:D}),v&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.18)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(255,255,255,0.97) 0%, rgba(255,255,255,0.89) 100%)",borderRadius:"28px",boxShadow:"0 20px 40px rgba(0,0,0,0.18)",padding:"32px 28px",minWidth:"320px",maxWidth:"95vw",border:"1px solid rgba(0,0,0,0.08)",textAlign:"center"},children:[e.jsx("div",{className:"mb-3 fw-semibold",style:{fontSize:"1.1rem"},children:l("confirmDelete")}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"fw-bold text-dark mb-1",children:s.find(t=>t.id===v)?.description}),e.jsxs("div",{className:"text-muted small mb-1",children:[_(R(s.find(t=>t.id===v)))," â€¢ ",K(s.find(t=>t.id===v)?.category)]}),e.jsxs("div",{className:"fw-bold",style:{color:s.find(t=>t.id===v)?.type==="income"?"#198754":"#dc3545"},children:[s.find(t=>t.id===v)?.type==="income"?"+":"-",X(s.find(t=>t.id===v)?.amount)]})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>z(null),style:{borderRadius:"16px",minWidth:"120px"},children:l("cancel")}),e.jsx("button",{className:"btn btn-danger",onClick:de,style:{borderRadius:"16px",minWidth:"180px"},children:l("transactions.deleteConfirm")})]})]})})]})};export{dt as default};
