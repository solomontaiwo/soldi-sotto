import{r as s,a1 as Te,j as e,a2 as se,a3 as Re,a4 as De,a5 as Fe,a6 as Ee,W as M,b as _,s as ie,m as O,B as w,X as ne,Y as le,a7 as Le,e as oe,_ as $,a as Me,a8 as We,a9 as Ie,aa as Oe,ab as qe,ac as Be}from"./index-DwuNFQE6.js";import{u as Q}from"./categories-D5Ve7pxs.js";import{M as X}from"./Modal-40swvqeV.js";import{F as u}from"./Form-BsGN6duT.js";import{R as de}from"./Row-JIUMbEbu.js";import{C as H}from"./Col-CT7zrK87.js";import{f as ee}from"./formatCurrency-DQxE0pTn.js";import{s as Ae,e as Pe,a as He}from"./endOfYear-DWwhox6z.js";import{t as K,c as G,n as Ge,s as U,a as Ye,b as $e,f as te,i as Ue}from"./it-CJeQdO6M.js";import{A as _e}from"./Alert-CVOdR-LY.js";class Qe extends s.Component{getSnapshotBeforeUpdate(l){const i=this.props.childRef.current;if(i&&l.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=i.offsetHeight||0,o.width=i.offsetWidth||0,o.top=i.offsetTop,o.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Xe({children:a,isPresent:l}){const i=s.useId(),o=s.useRef(null),v=s.useRef({width:0,height:0,top:0,left:0}),{nonce:y}=s.useContext(Te);return s.useInsertionEffect(()=>{const{width:C,height:m,top:k,left:f}=v.current;if(l||!o.current||!C||!m)return;o.current.dataset.motionPopId=i;const x=document.createElement("style");return y&&(x.nonce=y),document.head.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${C}px !important;
            height: ${m}px !important;
            top: ${k}px !important;
            left: ${f}px !important;
          }
        `),()=>{document.head.removeChild(x)}},[l]),e.jsx(Qe,{isPresent:l,childRef:o,sizeRef:v,children:s.cloneElement(a,{ref:o})})}const Ke=({children:a,initial:l,isPresent:i,onExitComplete:o,custom:v,presenceAffectsLayout:y,mode:C})=>{const m=se(Ve),k=s.useId(),f=s.useCallback(z=>{m.set(z,!0);for(const R of m.values())if(!R)return;o&&o()},[m,o]),x=s.useMemo(()=>({id:k,initial:l,isPresent:i,custom:v,onExitComplete:f,register:z=>(m.set(z,!1),()=>m.delete(z))}),y?[Math.random(),f]:[i,f]);return s.useMemo(()=>{m.forEach((z,R)=>m.set(R,!1))},[i]),s.useEffect(()=>{!i&&!m.size&&o&&o()},[i]),C==="popLayout"&&(a=e.jsx(Xe,{isPresent:i,children:a})),e.jsx(Re.Provider,{value:x,children:a})};function Ve(){return new Map}const P=a=>a.key||"";function ae(a){const l=[];return s.Children.forEach(a,i=>{s.isValidElement(i)&&l.push(i)}),l}const re=({children:a,custom:l,initial:i=!0,onExitComplete:o,presenceAffectsLayout:v=!0,mode:y="sync",propagate:C=!1})=>{const[m,k]=De(C),f=s.useMemo(()=>ae(a),[a]),x=C&&!m?[]:f.map(P),z=s.useRef(!0),R=s.useRef(f),p=se(()=>new Map),[j,D]=s.useState(f),[T,L]=s.useState(f);Fe(()=>{z.current=!1,R.current=f;for(let g=0;g<T.length;g++){const b=P(T[g]);x.includes(b)?p.delete(b):p.get(b)!==!0&&p.set(b,!1)}},[T,x.length,x.join("-")]);const N=[];if(f!==j){let g=[...f];for(let b=0;b<T.length;b++){const r=T[b],F=P(r);x.includes(F)||(g.splice(b,0,r),N.push(r))}y==="wait"&&N.length&&(g=N),L(ae(g)),D(f);return}const{forceRender:n}=s.useContext(Ee);return e.jsx(e.Fragment,{children:T.map(g=>{const b=P(g),r=C&&!m?!1:f===T||x.includes(b),F=()=>{if(p.has(b))p.set(b,!0);else return;let W=!0;p.forEach(Y=>{Y||(W=!1)}),W&&(n?.(),L(R.current),C&&k?.(),o&&o())};return e.jsx(Ke,{isPresent:r,initial:!z.current||i?void 0:!1,custom:r?void 0:l,presenceAffectsLayout:v,mode:y,onExitComplete:r?void 0:F,children:g},b)})})},ce=({transaction:a,onClose:l})=>{ce.propTypes={transaction:M.shape({id:M.string.isRequired,type:M.string.isRequired,amount:M.number.isRequired,description:M.string.isRequired,date:M.object.isRequired,category:M.string.isRequired}).isRequired,onClose:M.func.isRequired};const{updateTransaction:i}=_(),{expenseCategories:o,incomeCategories:v}=Q(),y=ie(),[C,m]=s.useState([]),[k,f]=s.useState(a.category),[x,z]=s.useState(!1),R=n=>n?.toDate?n.toDate():n instanceof Date?n:new Date(n),[p,j]=s.useState({type:a.type,amount:a.amount.toString(),description:a.description,date:R(a.date).toISOString().split("T")[0]}),D=s.useCallback(n=>{m(n==="expense"?o:v)},[o,v]);s.useEffect(()=>{D(p.type)},[p.type,D]);const T=async n=>{n.preventDefault(),z(!0);try{await i(a.id,{type:p.type,amount:parseFloat(p.amount),description:p.description,date:new Date(p.date),category:k})&&(y.success("Transazione aggiornata con successo!"),l())}catch(g){console.error("Errore nell'aggiornamento della transazione:",g),y.error("Errore nell'aggiornamento della transazione")}finally{z(!1)}},L=(n,g)=>{j(b=>({...b,[n]:g}))},N=n=>{j(g=>({...g,type:n})),D(n)};return e.jsx(X,{show:!0,onHide:l,centered:!0,size:"lg",backdrop:!1,className:"glass-modal",style:{background:"transparent"},children:e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{background:"rgba(0, 0, 0, 0.15)",backdropFilter:"blur(15px)",WebkitBackdropFilter:"blur(15px)",zIndex:1055,padding:"15px"},onClick:n=>{n.target===n.currentTarget&&l()},children:e.jsxs(O.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",damping:30,stiffness:400,duration:.3},style:{background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderRadius:"20px",border:"1px solid rgba(255, 255, 255, 0.6)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.2) inset",maxWidth:"650px",width:"100%",maxHeight:"85vh",overflow:"hidden",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:"100px",background:"linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(16, 185, 129, 0.03))",pointerEvents:"none"}}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-3 pb-2",children:[e.jsx("div",{children:e.jsxs("h4",{className:"fw-bold text-dark mb-1 d-flex align-items-center gap-2",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"36px",height:"36px",background:"linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(79, 70, 229, 0.1))",fontSize:"18px"},children:"✏️"}),"Modifica Transazione"]})}),e.jsx(w,{variant:"link",onClick:l,className:"text-muted p-0 d-flex align-items-center justify-content-center",style:{fontSize:"20px",width:"36px",height:"36px",borderRadius:"12px",background:"rgba(255, 255, 255, 0.8)",transition:"all 0.2s ease"},onMouseEnter:n=>{n.currentTarget.style.background="rgba(239, 68, 68, 0.1)",n.currentTarget.style.color="var(--accent-error)"},onMouseLeave:n=>{n.currentTarget.style.background="rgba(255, 255, 255, 0.8)",n.currentTarget.style.color=""},children:"×"})]}),e.jsxs("div",{className:"px-3 pb-3",style:{maxHeight:"calc(85vh - 80px)",overflowY:"auto"},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(u.Label,{className:"fw-semibold text-dark mb-2 small",children:"Tipo di Transazione"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(w,{variant:p.type==="expense"?"danger":"outline-danger",onClick:()=>N("expense"),className:"flex-fill d-flex align-items-center justify-content-center gap-2 py-2",style:{borderRadius:"12px",fontWeight:"600",fontSize:"14px",background:p.type==="expense"?"linear-gradient(135deg, var(--accent-error), #c82333)":"rgba(255, 255, 255, 0.8)",border:p.type==="expense"?"none":"2px solid var(--accent-error)"},children:[e.jsx(ne,{size:16}),"Uscita"]}),e.jsxs(w,{variant:p.type==="income"?"success":"outline-success",onClick:()=>N("income"),className:"flex-fill d-flex align-items-center justify-content-center gap-2 py-2",style:{borderRadius:"12px",fontWeight:"600",fontSize:"14px",background:p.type==="income"?"linear-gradient(135deg, var(--accent-success), #157347)":"rgba(255, 255, 255, 0.8)",border:p.type==="income"?"none":"2px solid var(--accent-success)"},children:[e.jsx(le,{size:16}),"Entrata"]})]})]}),e.jsxs(u,{onSubmit:T,children:[e.jsxs(de,{className:"mb-3",children:[e.jsx(H,{xs:6,children:e.jsxs(u.Group,{children:[e.jsx(u.Label,{className:"fw-semibold text-dark small mb-1",children:"Importo (€)"}),e.jsx(u.Control,{type:"number",step:"0.01",min:"0",placeholder:"0,00",value:p.amount,onChange:n=>L("amount",n.target.value),required:!0,className:"border-0",style:{height:"42px",borderRadius:"12px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"}})]})}),e.jsx(H,{xs:6,children:e.jsxs(u.Group,{children:[e.jsx(u.Label,{className:"fw-semibold text-dark small mb-1",children:"Data"}),e.jsx(u.Control,{type:"date",value:p.date,onChange:n=>L("date",n.target.value),required:!0,className:"border-0",style:{height:"42px",borderRadius:"12px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"}})]})})]}),e.jsxs(u.Group,{className:"mb-3",children:[e.jsx(u.Label,{className:"fw-semibold text-dark small mb-1",children:"Descrizione"}),e.jsx(u.Control,{type:"text",placeholder:"Es. Spesa alimentare, Stipendio...",value:p.description,onChange:n=>L("description",n.target.value),required:!0,className:"border-0",style:{height:"42px",borderRadius:"12px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"}})]}),e.jsxs(u.Group,{className:"mb-4",children:[e.jsx(u.Label,{className:"fw-semibold text-dark small mb-2",children:"Categoria"}),e.jsxs(u.Select,{value:k,onChange:n=>f(n.target.value),required:!0,className:"border-0",style:{height:"42px",borderRadius:"12px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:[e.jsx("option",{value:"",children:"Seleziona una categoria"}),C.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(w,{type:"button",variant:"outline-secondary",onClick:l,className:"flex-fill py-2",style:{borderRadius:"12px",fontWeight:"500",fontSize:"14px",background:"rgba(255, 255, 255, 0.9)",border:"1px solid rgba(0, 0, 0, 0.15)"},children:"Annulla"}),e.jsx(w,{type:"submit",disabled:x||!p.amount||!p.description||!k,className:"flex-fill border-0 fw-semibold py-2",style:{borderRadius:"12px",fontSize:"14px",background:p.type==="expense"?"linear-gradient(135deg, var(--accent-error), #c82333)":"linear-gradient(135deg, var(--accent-success), #157347)",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.15)"},children:x?e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),"Salvando..."]}):e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-1",children:[e.jsx(Le,{size:14}),"Salva Modifiche"]})})]})]})]})]})})})},pe=({show:a,onClose:l,onFormSubmit:i})=>{pe.propTypes={show:M.bool.isRequired,onClose:M.func.isRequired,onFormSubmit:M.func.isRequired};const{addTransaction:o}=_(),{expenseCategories:v,incomeCategories:y}=Q(),C=ie(),m=oe({maxWidth:768}),[k,f]=s.useState([]),[x,z]=s.useState("expense"),[R,p]=s.useState(""),[j,D]=s.useState({amount:"",description:"",date:new Date().toISOString().split("T")[0]}),[T,L]=s.useState(!1),N=s.useCallback(r=>{const F=r==="expense"?v:y;f(F),F.length>0&&p(F[0].value)},[v,y]);s.useEffect(()=>{N(x)},[x,N]),s.useEffect(()=>{a&&(D({amount:"",description:"",date:new Date().toISOString().split("T")[0]}),z("expense"),p(""))},[a]);const n=async r=>{r.preventDefault(),L(!0);try{await o({type:x,amount:parseFloat(j.amount),description:j.description,date:new Date(j.date),category:R})&&(D({amount:"",description:"",date:new Date().toISOString().split("T")[0]}),p(k[0]?.value||""),i(),l())}catch(F){console.error("Errore nell'aggiunta della transazione:",F),C.error("Errore nell'aggiunta della transazione")}finally{L(!1)}},g=(r,F)=>{D(W=>({...W,[r]:F}))},b=r=>{z(r),N(r)};return a?e.jsx(X,{show:a,onHide:l,centered:!0,size:"lg",backdrop:!1,className:"glass-modal",style:{background:"transparent"},children:e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{background:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(25px)",WebkitBackdropFilter:"blur(25px)",zIndex:1055,padding:m?"20px":"40px"},onClick:r=>{r.target===r.currentTarget&&l()},children:e.jsxs(O.div,{initial:{opacity:0,scale:.85,y:30},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.85,y:30},transition:{type:"spring",damping:25,stiffness:300,duration:.4},style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.8) 100%)",backdropFilter:"blur(30px)",WebkitBackdropFilter:"blur(30px)",borderRadius:"28px",border:"1px solid rgba(255, 255, 255, 0.4)",boxShadow:"0 25px 50px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.1) inset",maxWidth:"650px",width:"100%",maxHeight:"90vh",overflow:"hidden",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:"-50%",right:"-10%",width:"200px",height:"200px",background:"radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, transparent 70%)",borderRadius:"50%",pointerEvents:"none"}}),e.jsx("div",{style:{position:"absolute",bottom:"-30%",left:"-5%",width:"150px",height:"150px",background:"radial-gradient(circle, rgba(16, 185, 129, 0.12) 0%, transparent 70%)",borderRadius:"50%",pointerEvents:"none"}}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-4 pb-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"fw-bold text-dark mb-1 d-flex align-items-center gap-3",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 197, 253, 0.15))",backdropFilter:"blur(10px)",border:"1px solid rgba(59, 130, 246, 0.2)"},children:"⚡"}),"Nuova Transazione"]}),e.jsx("p",{className:"text-muted mb-0 ms-5 ps-3",style:{fontSize:"0.95rem"},children:"Aggiungi velocemente una nuova transazione"})]}),e.jsx(w,{variant:"link",onClick:l,className:"text-muted p-0 d-flex align-items-center justify-content-center",style:{fontSize:"22px",width:"44px",height:"44px",borderRadius:"16px",background:"rgba(255, 255, 255, 0.6)",backdropFilter:"blur(10px)",border:"1px solid rgba(0, 0, 0, 0.08)",transition:"all 0.3s ease"},onMouseEnter:r=>{r.currentTarget.style.background="rgba(239, 68, 68, 0.1)",r.currentTarget.style.color="var(--accent-error)",r.currentTarget.style.transform="scale(1.05)"},onMouseLeave:r=>{r.currentTarget.style.background="rgba(255, 255, 255, 0.6)",r.currentTarget.style.color="",r.currentTarget.style.transform="scale(1)"},children:"×"})]}),e.jsxs("div",{className:"p-4 pt-3",style:{maxHeight:"calc(90vh - 120px)",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"rgba(0,0,0,0.2) transparent"},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(u.Label,{className:"fw-semibold text-dark mb-2 small",children:"Tipo di Transazione"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(w,{variant:x==="expense"?"danger":"outline-danger",onClick:()=>b("expense"),className:"flex-fill d-flex align-items-center justify-content-center gap-2 py-2",style:{borderRadius:"12px",fontWeight:"600",fontSize:"14px",background:x==="expense"?"linear-gradient(135deg, var(--accent-error), #c82333)":"rgba(255, 255, 255, 0.8)",border:x==="expense"?"none":"2px solid var(--accent-error)"},children:[e.jsx(ne,{size:16}),"Spesa"]}),e.jsxs(w,{variant:x==="income"?"success":"outline-success",onClick:()=>b("income"),className:"flex-fill d-flex align-items-center justify-content-center gap-2 py-2",style:{borderRadius:"12px",fontWeight:"600",fontSize:"14px",background:x==="income"?"linear-gradient(135deg, var(--accent-success), #157347)":"rgba(255, 255, 255, 0.8)",border:x==="income"?"none":"2px solid var(--accent-success)"},children:[e.jsx(le,{size:16}),"Entrata"]})]})]}),e.jsxs(u,{onSubmit:n,children:[e.jsxs(de,{className:"mb-3",children:[e.jsx(H,{xs:m?12:6,className:m?"mb-3":"",children:e.jsxs(u.Group,{children:[e.jsx(u.Label,{className:"fw-semibold text-dark small mb-1",children:"Importo (€)"}),e.jsx(u.Control,{type:"number",step:"0.01",min:"0",placeholder:"0,00",value:j.amount,onChange:r=>g("amount",r.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"}})]})}),e.jsx(H,{xs:m?12:6,children:e.jsxs(u.Group,{children:[e.jsx(u.Label,{className:"fw-semibold text-dark small mb-1",children:"Data"}),e.jsx(u.Control,{type:"date",value:j.date,onChange:r=>g("date",r.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"}})]})})]}),e.jsxs(u.Group,{className:"mb-3",children:[e.jsx(u.Label,{className:"fw-semibold text-dark small mb-1",children:"Descrizione"}),e.jsx(u.Control,{type:"text",placeholder:"Es. Spesa alimentare, Stipendio...",value:j.description,onChange:r=>g("description",r.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"}})]}),e.jsxs(u.Group,{className:"mb-4",children:[e.jsx(u.Label,{className:"fw-semibold text-dark small mb-2",children:"Categoria"}),e.jsxs(u.Select,{value:R,onChange:r=>p(r.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"},children:[e.jsx("option",{value:"",children:"Seleziona una categoria"}),k.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(w,{type:"button",variant:"outline-secondary",onClick:l,className:"flex-fill py-2",style:{borderRadius:"12px",fontWeight:"500",fontSize:"14px",background:"rgba(255, 255, 255, 0.9)",border:"1px solid rgba(0, 0, 0, 0.15)"},children:"Annulla"}),e.jsx(w,{type:"submit",disabled:T||!j.amount||!j.description||!R,className:"flex-fill border-0 fw-semibold py-2",style:{borderRadius:"12px",fontSize:"14px",background:x==="expense"?"linear-gradient(135deg, var(--accent-error), #c82333)":"linear-gradient(135deg, var(--accent-success), #157347)",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.15)"},children:T?e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),"Aggiungendo..."]}):e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-1",children:[e.jsx($,{size:16}),"Aggiungi ",x==="expense"?"Spesa":"Entrata"]})})]})]})]})]})})}):null};function Je(a,l,i){const o=K(a,i?.in);return isNaN(l)?G(a,NaN):(o.setDate(o.getDate()+l),o)}function xe(a){return G(a,Date.now())}function ue(a,l,i){const[o,v]=Ge(i?.in,a,l);return+U(o)==+U(v)}function Ze(a,l){const i=K(a,l?.in);return i.setHours(23,59,59,999),i}function et(a,l){const i=l?.weekStartsOn,o=K(a,l?.in),v=o.getDay(),y=(v<i?-7:0)+6-(v-i);return o.setDate(o.getDate()+y),o.setHours(23,59,59,999),o}function tt(a,l){return ue(G(a,a),xe(a))}function at(a,l,i){return Je(a,-1,i)}function rt(a,l){return ue(G(a,a),at(xe(a)))}const gt=()=>{const{currentUser:a,loading:l}=Me(),{transactions:i,loading:o,deleteTransaction:v,isDemo:y,canAddMoreTransactions:C,maxTransactions:m}=_(),{expenseCategories:k,incomeCategories:f}=Q(),[x,z]=s.useState([]),[R,p]=s.useState(null),[j,D]=s.useState(null),[T,L]=s.useState("monthly"),[N,n]=s.useState(""),[g,b]=s.useState(!1),[r,F]=s.useState(!1),[W,Y]=s.useState("all"),[q,ge]=s.useState("all"),d=oe({maxWidth:768}),B=l||o,V=["Ogni euro risparmiato è un euro guadagnato.","Il miglior investimento sei tu.","Piccoli passi, grandi risultati.","Gestire le tue finanze è il primo passo verso la libertà.","Non contare i centesimi, falli contare!","La ricchezza si costruisce un giorno alla volta.","Il futuro appartiene a chi lo pianifica.","Risparmiare oggi per vivere meglio domani.","Non è quanto guadagni, ma quanto risparmi che conta.","La disciplina finanziaria è la chiave del successo."],[me,be]=s.useState("");s.useEffect(()=>{be(V[Math.floor(Math.random()*V.length)])},[]);const he=t=>tt(t)?"Oggi":rt(t)?"Ieri":te(t,"dd MMMM yyyy",{locale:Ue}),I=t=>t.date?.toDate?t.date.toDate():t.date?.seconds?new Date(t.date.seconds*1e3):t.date instanceof Date?t.date:new Date(t.date),fe=t=>{const S={};return t.forEach(c=>{const E=I(c),h=te(E,"yyyy-MM-dd");S[h]||(S[h]={date:E,displayDate:he(E),transactions:[]}),S[h].transactions.push(c)}),Object.values(S).sort((c,E)=>E.date-c.date)};s.useEffect(()=>{if(i.length>0){const t=new Date;let S,c;switch(T){case"weekly":S=$e(t,{weekStartsOn:1}),c=et(t,{weekStartsOn:1});break;case"daily":S=U(t),c=Ze(t);break;case"annually":S=Ye(t),c=He(t);break;case"all":S=new Date(0),c=new Date;break;case"monthly":default:S=Ae(t),c=Pe(t);break}let E=i.filter(h=>{const A=I(h),Se=A>=S&&A<=c,we=N===""||h.description.toLowerCase().includes(N.toLowerCase())||h.category.toLowerCase().includes(N.toLowerCase()),Ce=W==="all"||h.category===W,ze=q==="all"||h.type===q;return Se&&we&&Ce&&ze});E.sort((h,A)=>I(A)-I(h)),z(E)}},[i,T,N,W,q]);const ye=async t=>{D(t)},ve=async()=>{j&&await v(j)&&D(null)},je=[...new Set(i.map(t=>t.category))],ke=[{value:"daily",label:"Oggi"},{value:"weekly",label:"Settimana"},{value:"monthly",label:"Mese"},{value:"annually",label:"Anno"},{value:"all",label:"Tutto"}],Ne=t=>{const c=[...k,...f].find(E=>E.value===t);return c?c.label.split(" ")[0]:"💸"},J=t=>{const c=[...k,...f].find(E=>E.value===t);return c?c.label:t};if(B)return e.jsx("div",{className:"d-flex justify-content-center align-items-center vh-100",style:{background:"var(--gradient-soft-blue)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border mb-3",style:{color:"var(--primary-500)"},role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Caricamento..."})}),e.jsx("h5",{className:"text-dark",children:"Caricamento transazioni..."})]})});if(!a&&!y)return e.jsx("div",{className:"min-vh-100 d-flex align-items-center justify-content-center",style:{background:"var(--gradient-soft-blue)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"display-6 text-dark mb-3",children:"Accesso richiesto"}),e.jsx("p",{className:"lead text-muted",children:"Effettua il login per visualizzare le tue transazioni"})]})});const Z=fe(x);return e.jsxs("div",{className:"min-vh-100",style:{background:"linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)",overflowX:"hidden",WebkitOverflowScrolling:"touch"},children:[e.jsx(O.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"position-sticky top-0",style:{backgroundColor:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(25px)",WebkitBackdropFilter:"blur(25px)",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 1px 20px rgba(0, 0, 0, 0.08)",zIndex:1020,padding:"16px 0"},children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`fw-bold text-dark mb-1 ${d?"h4":"h2"}`,children:"💳 Le tue Transazioni"}),e.jsx("div",{className:"text-primary fw-medium mb-2",style:{fontSize:d?"1rem":"1.15rem",opacity:.85},children:e.jsx("span",{style:{fontStyle:"italic"},children:me})}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(We,{className:"small",style:{backgroundColor:"rgba(255, 255, 255, 0.6)",color:"var(--text-secondary)",border:"1px solid rgba(255, 255, 255, 0.3)",backdropFilter:"blur(10px)",borderRadius:"8px"},children:x.length}),x.length!==i.length&&e.jsxs("span",{className:"text-muted small",children:["di ",i.length]})]})]}),e.jsxs(w,{variant:"primary",size:d?"sm":"md",onClick:()=>b(!0),disabled:y&&!C,className:"d-flex align-items-center gap-1",style:{background:"linear-gradient(135deg, var(--primary-500), var(--primary-600))",borderColor:"var(--primary-500)",borderRadius:"1.5rem",padding:d?"8px 16px":"12px 20px",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[e.jsx($,{size:d?16:18}),!d&&e.jsx("span",{children:"Aggiungi"})]})]}),e.jsxs("div",{className:"position-relative mb-3",children:[e.jsx(Ie,{className:"position-absolute top-50 start-0 translate-middle-y text-muted ms-3",size:18}),e.jsx(u.Control,{type:"text",className:"ps-5 border-0",placeholder:"Cerca transazioni...",value:N,onChange:t=>n(t.target.value),style:{borderRadius:"1.5rem",padding:d?"12px 16px 12px 48px":"14px 16px 14px 48px",background:"rgba(255, 255, 255, 0.75)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"}})]}),e.jsxs("div",{className:`d-flex gap-2 mb-2 ${d?"flex-column":"flex-row"}`,children:[e.jsx(u.Select,{value:T,onChange:t=>L(t.target.value),className:"border-0",style:{borderRadius:"0.75rem",fontSize:d?"14px":"16px",flex:d?"none":"1",marginBottom:d?"8px":"0",background:"rgba(255, 255, 255, 0.75)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:ke.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsxs(w,{variant:r?"primary":"outline-secondary",size:"sm",onClick:()=>F(!r),className:"d-flex align-items-center gap-1 px-3",style:{borderRadius:"0.75rem",background:r?"linear-gradient(135deg, var(--primary-500), var(--primary-600))":"rgba(255, 255, 255, 0.75)",borderColor:r?"var(--primary-500)":"rgba(255, 255, 255, 0.3)",color:r?"white":"var(--text-secondary)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",minWidth:d?"100%":"auto"},children:[e.jsx(Oe,{size:16}),!d&&"Filtri",d&&(r?"Nascondi Filtri":"Mostra Filtri")]})]}),y&&e.jsx(_e,{variant:"info",className:"mb-0 border-0 small",style:{background:"rgba(255, 255, 255, 0.6)",color:"var(--text-secondary)",borderRadius:"1.5rem",padding:d?"8px 12px":"12px 16px",border:"1px solid rgba(255, 255, 255, 0.3)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{children:"🎯"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Modalità Demo"})," - ",i.length,"/",m," transazioni"]})]})}),e.jsx(re,{children:r&&e.jsx(O.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-3",children:e.jsxs("div",{className:`${d?"d-flex flex-column gap-2":"row g-2"}`,children:[e.jsx("div",{className:d?"w-100":"col-6",children:e.jsxs(u.Select,{value:q,onChange:t=>ge(t.target.value),className:"border-0 small",style:{borderRadius:"0.75rem",background:"rgba(255, 255, 255, 0.75)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:[e.jsx("option",{value:"all",children:"Tutti"}),e.jsx("option",{value:"income",children:"Entrate"}),e.jsx("option",{value:"expense",children:"Uscite"})]})}),e.jsx("div",{className:d?"w-100":"col-6",children:e.jsxs(u.Select,{value:W,onChange:t=>Y(t.target.value),className:"border-0 small",style:{borderRadius:"0.75rem",background:"rgba(255, 255, 255, 0.75)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:[e.jsx("option",{value:"all",children:"Categorie"}),je.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]})})]})})})]})}),e.jsx("div",{className:"container",style:{paddingBottom:d?"100px":"40px",paddingTop:"20px"},children:Z.length>0?e.jsx("div",{className:"mt-4",children:e.jsx(re,{children:Z.map((t,S)=>e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:S*.1},className:"mb-5",children:[e.jsxs("div",{className:"d-flex align-items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex-grow-1",style:{height:"2px",background:"rgba(0, 0, 0, 0.1)",borderRadius:"1px"}}),e.jsx("span",{className:"fw-medium px-3 py-1 timeline-date-badge",style:{background:"var(--timeline-date-bg, rgba(255,255,255,0.65))",color:"var(--timeline-date-color, var(--text-secondary))",borderRadius:"1rem",fontSize:"0.875rem",border:"1px solid var(--timeline-date-border, rgba(0,0,0,0.08))",backdropFilter:"blur(8px)"},children:t.displayDate}),e.jsx("div",{className:"flex-grow-1",style:{height:"2px",background:"rgba(0, 0, 0, 0.1)",borderRadius:"1px"}})]}),e.jsx("div",{className:"d-flex flex-column gap-3",children:t.transactions.map((c,E)=>e.jsxs(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:E*.05},className:"d-flex align-items-center justify-content-between p-3 mb-2 rounded-3",style:{background:"rgba(255, 255, 255, 0.95)",border:"1px solid rgba(0, 0, 0, 0.08)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",cursor:"pointer",transition:"all 0.2s ease",minHeight:d?"70px":"60px"},onMouseEnter:h=>{h.currentTarget.style.background="rgba(255, 255, 255, 1)",h.currentTarget.style.transform="translateX(4px)",h.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.1)"},onMouseLeave:h=>{h.currentTarget.style.background="rgba(255, 255, 255, 0.95)",h.currentTarget.style.transform="translateX(0)",h.currentTarget.style.boxShadow=""},children:[e.jsxs("div",{className:"d-flex align-items-center gap-3 flex-grow-1",style:{minWidth:0},children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center flex-shrink-0",style:{width:d?"44px":"40px",height:d?"44px":"40px",backgroundColor:c.type==="income"?"rgba(34, 197, 94, 0.15)":"rgba(239, 68, 68, 0.15)",color:c.type==="income"?"#22c55e":"#ef4444",fontSize:d?"18px":"16px"},children:c.type==="income"?"💰":Ne(c.category)}),e.jsxs("div",{className:"flex-grow-1",style:{minWidth:0,overflow:"hidden"},children:[e.jsx("div",{className:"fw-semibold text-dark mb-1",style:{fontSize:d?"15px":"14px",lineHeight:"1.3",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:c.description}),d?e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small mb-1",style:{fontSize:"12px"},children:I(c).toLocaleDateString("it-IT",{day:"2-digit",month:"short"})}),e.jsx("div",{className:"text-muted small",style:{fontSize:"11px",opacity:.8},children:J(c.category)})]}):e.jsxs("div",{className:"text-muted small d-flex align-items-center gap-2",children:[e.jsx("span",{children:I(c).toLocaleDateString("it-IT")}),e.jsx("span",{children:"•"}),e.jsx("span",{children:J(c.category)})]})]})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"text-end",children:[e.jsxs("div",{className:"fw-bold",style:{fontSize:d?"16px":"15px",color:c.type==="income"?"#22c55e":"#ef4444",lineHeight:"1.2"},children:[c.type==="income"?"+":"-",ee(c.amount)]}),d&&e.jsx("div",{className:"text-muted small",style:{fontSize:"10px"},children:I(c).toLocaleDateString("it-IT",{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx(w,{variant:"link",size:"sm",onClick:h=>{h.stopPropagation(),p(c)},className:"text-info p-1 d-flex align-items-center justify-content-center",style:{width:d?"32px":"28px",height:d?"32px":"28px",borderRadius:"8px",backgroundColor:"rgba(13, 202, 240, 0.1)",border:"1px solid rgba(13, 202, 240, 0.2)"},children:e.jsx(qe,{size:d?14:12})}),e.jsx(w,{variant:"link",size:"sm",onClick:h=>{h.stopPropagation(),ye(c.id)},className:"text-danger p-1 d-flex align-items-center justify-content-center",style:{width:d?"32px":"28px",height:d?"32px":"28px",borderRadius:"8px",backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)"},children:e.jsx(Be,{size:d?14:12})})]})]})]},c.id))})]},t.date.toISOString()))})}):e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-5",style:{marginTop:"3rem"},children:[e.jsx("div",{className:"mx-auto mb-4 rounded-circle d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",background:"rgba(255, 255, 255, 0.65)",border:"1px solid rgba(0, 0, 0, 0.08)",backdropFilter:"blur(8px)"},children:e.jsx("span",{style:{fontSize:"3rem"},children:"💳"})}),e.jsx("h3",{className:"text-dark fw-bold mb-2",children:"Nessuna transazione trovata"}),e.jsx("p",{className:"text-muted mb-4",children:N||W!=="all"||q!=="all"?"Prova a modificare i filtri di ricerca":"Inizia aggiungendo la tua prima transazione"}),e.jsxs(w,{variant:"primary",size:"lg",onClick:()=>b(!0),disabled:y&&!C,className:"d-flex align-items-center gap-2 mx-auto",style:{background:"linear-gradient(135deg, var(--primary-500), var(--primary-600))",borderColor:"var(--primary-500)",borderRadius:"1.5rem",padding:"12px 24px",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},children:[e.jsx($,{size:20}),"Aggiungi Transazione"]})]})}),e.jsx(pe,{show:g,onClose:()=>b(!1),onFormSubmit:()=>{}}),R&&e.jsx(ce,{transaction:R,onClose:()=>p(null)}),e.jsx(X,{show:!!j,onHide:()=>D(null),backdrop:!1,className:"glass-modal",style:{background:"transparent"},children:e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{background:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",zIndex:1055,padding:"20px"},onClick:t=>{t.target===t.currentTarget&&D(null)},children:e.jsxs(O.div,{initial:{opacity:0,scale:.85},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.85},transition:{type:"spring",damping:30,stiffness:400,duration:.3},style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%)",backdropFilter:"blur(30px)",WebkitBackdropFilter:"blur(30px)",borderRadius:"24px",border:"1px solid rgba(255, 255, 255, 0.5)",boxShadow:"0 20px 40px rgba(239, 68, 68, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.2) inset",maxWidth:"480px",width:"100%",overflow:"hidden",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:"-50%",right:"-20%",width:"200px",height:"200px",background:"radial-gradient(circle, rgba(239, 68, 68, 0.08) 0%, transparent 70%)",borderRadius:"50%",pointerEvents:"none"}}),e.jsxs("div",{className:"p-4 pb-3",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"rounded-circle mx-auto d-flex align-items-center justify-content-center mb-3",style:{width:"64px",height:"64px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.1))",backdropFilter:"blur(10px)",border:"1px solid rgba(239, 68, 68, 0.2)",fontSize:"28px"},children:"🗑️"}),e.jsx("h4",{className:"fw-bold text-dark mb-2",children:"Elimina Transazione"}),e.jsx("p",{className:"text-muted mb-0",style:{fontSize:"0.95rem"},children:"Sei sicuro di voler eliminare questa transazione? Questa azione non può essere annullata."})]}),j&&e.jsx("div",{className:"p-3 rounded-3 mb-4",style:{background:"rgba(239, 68, 68, 0.05)",border:"1px solid rgba(239, 68, 68, 0.1)",backdropFilter:"blur(10px)"},children:(()=>{const t=i.find(S=>S.id===j);return t?e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark mb-1",children:t.description}),e.jsxs("small",{className:"text-muted",children:[I(t).toLocaleDateString("it-IT")," • ",t.category]})]}),e.jsxs("div",{className:`fw-bold ${t.type==="income"?"text-success":"text-danger"}`,children:[t.type==="income"?"+":"-",ee(t.amount)]})]}):null})()}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx(w,{variant:"outline-secondary",onClick:()=>D(null),className:"flex-fill py-3",style:{borderRadius:"16px",fontWeight:"500",fontSize:"16px",background:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)",border:"1px solid rgba(0, 0, 0, 0.1)",transition:"all 0.3s ease"},onMouseEnter:t=>{t.currentTarget.style.background="rgba(255, 255, 255, 0.9)",t.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:t=>{t.currentTarget.style.background="rgba(255, 255, 255, 0.8)",t.currentTarget.style.transform="translateY(0)"},children:"Annulla"}),e.jsx(w,{variant:"danger",onClick:ve,disabled:B,className:"flex-fill py-3 border-0 fw-semibold",style:{borderRadius:"16px",fontSize:"16px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.95))",boxShadow:"0 8px 25px rgba(239, 68, 68, 0.3)",transition:"all 0.3s ease"},onMouseEnter:t=>{B||(t.currentTarget.style.transform="translateY(-1px)",t.currentTarget.style.boxShadow="0 12px 35px rgba(239, 68, 68, 0.4)")},onMouseLeave:t=>{t.currentTarget.style.transform="translateY(0)",t.currentTarget.style.boxShadow="0 8px 25px rgba(239, 68, 68, 0.3)"},children:B?e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-2",children:[e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),"Eliminando..."]}):"Elimina Definitivamente"})]})]})]})})})]})};export{gt as default};
