import{R as K,e as Q,f as X,r as o,u as Z,b as ee,j as e,B as x,P as c}from"./index-DssBxwp5.js";import{d as se,h as ae,j as te,k as ne,l as le,m as re,s as I,o as B,c as oe,p as ie,S as O,b as ce,f as i}from"./statsUtils-5rr_oV2s.js";import{i as de,b as L,c as me,d as xe}from"./pdfUtils-CJTnEReh.js";import{L as ue}from"./loadingWrapper-grKeTDD0.js";import{C as u,a as b,b as h,c as y,d as N}from"./card-BNvv_Wep.js";import"./it-DLwuBId3.js";const he="/soldi-sotto/icon.png",g=({label:d,value:j,tone:r})=>{const S={emerald:"bg-emerald-500/10",rose:"bg-rose-500/10",primary:"bg-primary/10",secondary:"bg-muted"};return e.jsxs("div",{className:`rounded-xl border border-border p-4 ${S[r]||"bg-muted"}`,children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:d}),e.jsx("p",{className:"text-2xl font-semibold mt-1",children:j})]})};g.propTypes={label:c.node,value:c.oneOfType([c.string,c.number,c.node]),tone:c.oneOf(["emerald","rose","primary","secondary"])};g.defaultProps={label:"",value:"",tone:"secondary"};const w=({value:d,color:j="emerald"})=>{const r={emerald:"bg-emerald-500",rose:"bg-rose-500",primary:"bg-primary"};return e.jsx("div",{className:"w-full h-3 rounded-full bg-muted",children:e.jsx("div",{className:`h-3 rounded-full ${r[j]||r.primary}`,style:{width:`${Math.min(100,Math.max(0,d))}%`}})})};w.propTypes={value:c.number,color:c.oneOf(["emerald","rose","primary"])};w.defaultProps={value:0,color:"emerald"};const ge=()=>{const{currentUser:d,loading:j}=Q(),{transactions:r,loading:S,isDemo:A,startDemo:V}=X(),[s,E]=o.useState(null),[p,W]=o.useState("monthly"),[C,$]=o.useState(null),[P,M]=o.useState(null),[D,T]=o.useState(null),k=Z(),{t,i18n:F}=ee(),f=j||S,U=a=>{if(!a)return null;if(a.toDate)return a.toDate();if(a.seconds)return new Date(a.seconds*1e3);const n=new Date(a);return isNaN(n.getTime())?null:n};o.useEffect(()=>{if(!f&&r.length>0){const a=new Date;let n,l;if(p==="custom"&&C)[n,l]=C;else switch(p){case"daily":n=I(a),l=B(a);break;case"weekly":n=le(a,{weekStartsOn:1}),l=re(a,{weekStartsOn:1});break;case"annually":n=te(a),l=ne(a);break;case"monthly":default:n=se(a),l=ae(a);break}const G=r.filter(J=>{const v=U(J.date);return v?(de(v,n)||L(v,n))&&(me(v,l)||L(v,l)):!1});E(oe(G,n,l)),M(n),T(l)}else!f&&r.length===0&&(E(null),M(null),T(null))},[f,r,p,C]);const Y=a=>{W(a),a!=="custom"&&$(null)},m=o.useMemo(()=>P&&D?ie(B(D),I(P))+1:0,[P,D]),_=o.useMemo(()=>s&&m?s.totalIncome/m:0,[s,m]),q=o.useMemo(()=>s&&m?s.totalExpense/m:0,[s,m]),R=o.useMemo(()=>s&&s.totalIncome?(s.totalIncome-s.totalExpense)/s.totalIncome*100:0,[s]);if(f)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(O,{height:48,borderRadius:12}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((a,n)=>e.jsx(O,{height:120,borderRadius:18},n))}),e.jsx(O,{height:200,borderRadius:18})]});if(!d&&!A)return e.jsx("div",{className:"container py-5",children:e.jsxs(u,{className:"p-6 text-center",children:[e.jsxs(b,{children:[e.jsx(h,{children:t("statsPage.loginTitle")}),e.jsx(y,{children:t("statsPage.loginSubtitle")})]}),e.jsxs(N,{className:"flex flex-col gap-2 md:flex-row md:justify-center",children:[e.jsx(x,{onClick:()=>k("/login"),children:t("navLogin")}),e.jsx(x,{variant:"outline",onClick:()=>k("/register"),children:t("navRegister")}),e.jsx(x,{variant:"secondary",onClick:()=>{V(),k("/transactions")},children:t("statsPage.tryDemo")})]})]})});const z=s&&s.totalIncome?s.totalIncome/Math.max(1,s.totalIncome+s.totalExpense)*100:0,H=s&&s.transactionCount>0;return e.jsx(ue,{loading:f,children:e.jsxs("div",{className:"page-shell",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:t("statsPage.title")}),e.jsx("p",{className:"text-muted-foreground",children:t("statsPage.subtitle")})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row",children:[e.jsxs(ce,{value:p,onChange:a=>Y(a.target.value),className:"md:w-48",children:[e.jsx("option",{value:"daily",children:"Oggi"}),e.jsx("option",{value:"weekly",children:"Settimana"}),e.jsx("option",{value:"monthly",children:"Mese"}),e.jsx("option",{value:"annually",children:"Anno"})]}),d?e.jsx(x,{onClick:()=>xe(d,r,s,p,he,"https://solomontaiwo.github.io/soldi-sotto/","https://www.instagram.com/solomon.taiwo/",P,D,F.language),disabled:!s,children:t("statsPage.downloadPdf")}):e.jsx(x,{variant:"outline",disabled:!0,children:t("statsPage.pdfLoginNotice")})]})]}),H?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(g,{label:t("financialOverview.totalIncome"),value:i(s.totalIncome),tone:"emerald"}),e.jsx(g,{label:t("financialOverview.totalExpense"),value:i(s.totalExpense),tone:"rose"}),e.jsx(g,{label:t("financialOverview.balance"),value:i(s.balance),tone:"primary"}),e.jsx(g,{label:t("statsPage.transactions"),value:s.transactionCount,tone:"secondary"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(u,{children:[e.jsxs(b,{children:[e.jsx(h,{children:t("statsPage.incomeVsExpense")}),e.jsxs(y,{children:[s.transactionCount," ",t("statsPage.movements")]})]}),e.jsxs(N,{className:"space-y-3",children:[e.jsx(w,{value:z,color:"emerald"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-emerald-600",children:i(s.totalIncome)}),e.jsxs("span",{className:"text-rose-600",children:["-",i(s.totalExpense)]})]})]})]}),e.jsxs(u,{children:[e.jsxs(b,{children:[e.jsx(h,{children:t("statsPage.savingsRate")}),e.jsx(y,{children:t("statsPage.period")})]}),e.jsxs(N,{className:"space-y-3",children:[e.jsx(w,{value:R,color:s.balance>=0?"emerald":"rose"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-semibold",children:i(s.balance)}),e.jsxs("span",{className:s.balance>=0?"text-emerald-600":"text-rose-600",children:[R.toFixed(1),"%"]})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(u,{children:[e.jsx(b,{children:e.jsx(h,{children:t("statsPage.dailyAverages")})}),e.jsxs(N,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("statsPage.avgIncome")}),e.jsx("span",{className:"text-emerald-600 font-semibold",children:i(_)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("statsPage.avgExpense")}),e.jsx("span",{className:"text-rose-600 font-semibold",children:i(q)})]})]})]}),e.jsxs(u,{children:[e.jsxs(b,{children:[e.jsx(h,{children:t("statsPage.categoryBreakdown")}),e.jsx(y,{children:t("statsPage.ofExpenses")})]}),e.jsx(N,{className:"space-y-2",children:s.categoryBreakdown&&Object.entries(s.categoryBreakdown).sort(([,a],[,n])=>n-a).map(([a,n])=>{const l=s.totalExpense>0?n/s.totalExpense*100:0;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"capitalize",children:a}),e.jsx("span",{className:"font-semibold text-rose-600",children:i(n)})]}),e.jsx(w,{value:l,color:"rose"})]},a)})})]})]})]}):e.jsxs(u,{className:"text-center p-8",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ðŸ“Š"}),e.jsx(h,{children:t("statsPage.emptyTitle")}),e.jsx(y,{children:t("statsPage.emptySubtitle")}),e.jsx("div",{className:"mt-4",children:e.jsx(x,{onClick:()=>k("/transactions"),children:t("addTransaction")})})]})]})})},Ne=K.memo(ge);export{Ne as default};
