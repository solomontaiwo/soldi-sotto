import{r as f,u as ce,j as e,c as ae,R as oe,k as de,d as me,e as xe,g as _,h as J,H as K,I as pe,m as z,J as he,o as q,K as $,N as be,O as ue,Q as ge}from"./index-B5Mx-j49.js";import{f as y}from"./formatCurrency-DQxE0pTn.js";import{u as ye}from"./categories-EAu0DKNl.js";import{t as I,c as G,a as B,e as S,b as je,d as fe,g as ve}from"./format-CrPPGQr8.js";import{m as Ne,F as E}from"./Form-DDQ0nsY5.js";import{A as V}from"./Alert-D0XMxK0g.js";import{R as Y}from"./Row-C7_sTGgc.js";import{C as M}from"./Col-DpLbBq7f.js";import{C as p}from"./Card-CnwtaZdN.js";import{i as we}from"./it-DBO_pyXn.js";import"./hook-BkOoY0ZY.js";import"./useEventCallback-1-eyDLsX.js";const X=1e3;function ke(d,l,o){const i=(d-l)/(o-l)*100;return Math.round(i*X)/X}function Z({min:d,now:l,max:o,label:i,visuallyHidden:b,striped:h,animated:x,className:v,style:j,variant:N,bsPrefix:r,...C},t){return e.jsx("div",{ref:t,...C,role:"progressbar",className:ae(v,`${r}-bar`,{[`bg-${N}`]:N,[`${r}-bar-animated`]:x,[`${r}-bar-striped`]:x||h}),style:{width:`${ke(l,d,o)}%`,...j},"aria-valuenow":l,"aria-valuemin":d,"aria-valuemax":o,children:b?e.jsx("span",{className:"visually-hidden",children:i}):i})}const H=f.forwardRef(({isChild:d=!1,...l},o)=>{const i={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...l};if(i.bsPrefix=ce(i.bsPrefix,"progress"),d)return Z(i,o);const{min:b,now:h,max:x,label:v,visuallyHidden:j,striped:N,animated:r,bsPrefix:C,variant:t,className:P,children:T,...a}=i;return e.jsx("div",{ref:o,...a,className:ae(P,C),children:T?Ne(T,n=>f.cloneElement(n,{isChild:!0})):Z({min:b,now:h,max:x,label:v,visuallyHidden:j,striped:N,animated:r,bsPrefix:C,variant:t},o)})});H.displayName="ProgressBar";function Ce(d,l,o){const i=I(d,o?.in);if(isNaN(l))return G(d,NaN);if(!l)return i;const b=i.getDate(),h=G(d,i.getTime());h.setMonth(i.getMonth()+l+1,0);const x=h.getDate();return b>=x?h:(i.setFullYear(h.getFullYear(),h.getMonth(),b),i)}function ee(d,l,o){const i=+I(d,o?.in),[b,h]=[+I(l.start,o?.in),+I(l.end,o?.in)].sort((x,v)=>x-v);return i>=b&&i<=h}function W(d,l,o){return Ce(d,-l,o)}const De=()=>{const{isDemo:d,transactions:l,maxTransactions:o}=de(),{expenseCategories:i,incomeCategories:b}=ye(),h=me({maxWidth:768}),[x,v]=f.useState("month"),[j,N]=f.useState({from:"",to:""}),[r,C]=f.useState({}),{t}=xe(),P=f.useMemo(()=>[{title:t("analytics.totalIncome"),value:r.totalIncome||0,icon:e.jsx(_,{size:24}),color:"var(--accent-success)",bgColor:"var(--pastel-mint)",formatter:y},{title:t("analytics.totalExpense"),value:r.totalExpense||0,icon:e.jsx(J,{size:24}),color:"var(--accent-error)",bgColor:"var(--pastel-coral)",formatter:y},{title:t("analytics.balance"),value:r.balance||0,icon:e.jsx(K,{size:24}),color:r.balance>=0?"var(--accent-success)":"var(--accent-error)",bgColor:r.balance>=0?"var(--pastel-mint)":"var(--pastel-coral)",formatter:y},{title:t("analytics.savingsRate"),value:r.savingsRate||0,icon:e.jsx(pe,{size:24}),color:r.savingsRate>=20?"var(--accent-success)":r.savingsRate>=10?"var(--accent-warning)":"var(--accent-error)",bgColor:r.savingsRate>=20?"var(--pastel-mint)":r.savingsRate>=10?"var(--pastel-cream)":"var(--pastel-coral)",formatter:a=>`${a.toFixed(1)}%`}],[r,t]),T=f.useMemo(()=>{if(!l.length)return{};const a=new Date;let n,m;switch(x){case"thisMonth":n=B(a),m=S(a);break;case"lastMonth":{const s=W(a,1);n=B(s),m=S(s);break}case"thisYear":case"year":n=je(a),m=fe(a);break;case"last3Months":n=B(W(a,2)),m=S(a);break;case"custom":n=new Date(j.from),m=new Date(j.to);break;default:n=B(a),m=S(a)}const w=l.filter(s=>{const c=s.date.toDate?s.date.toDate():new Date(s.date);return ee(c,{start:n,end:m})}),k=w.filter(s=>s.type==="income").reduce((s,c)=>s+c.amount,0),D=w.filter(s=>s.type==="expense").reduce((s,c)=>s+c.amount,0),se=k-D,O={},A={};w.forEach(s=>{s.type==="expense"?O[s.category]=(O[s.category]||0)+s.amount:A[s.category]=(A[s.category]||0)+s.amount});const te=Object.entries(O).sort(([,s],[,c])=>c-s).slice(0,5).map(([s,c])=>{const u=i.find(F=>F.value===s);return{category:s,amount:c,percentage:D>0?c/D*100:0,label:u?u.label:s,emoji:u?u.label.split(" ")[0]:"ðŸ’¸"}}),re=Object.entries(A).sort(([,s],[,c])=>c-s).slice(0,5).map(([s,c])=>{const u=b.find(F=>F.value===s);return{category:s,amount:c,percentage:k>0?c/k*100:0,label:u?u.label:s,emoji:u?u.label.split(" ")[0]:"ðŸ’°"}}),L=[];for(let s=5;s>=0;s--){const c=B(W(a,s)),u=S(W(a,s)),F=l.filter(g=>{const R=g.date.toDate?g.date.toDate():new Date(g.date);return ee(R,{start:c,end:u})}),U=F.filter(g=>g.type==="income").reduce((g,R)=>g+R.amount,0),Q=F.filter(g=>g.type==="expense").reduce((g,R)=>g+R.amount,0);L.push({month:ve(c,"MMM yyyy",{locale:we}),income:U,expense:Q,balance:U-Q})}const ne=k>0?(k-D)/k*100:0,le=D/Math.max(1,(m-n)/(1e3*60*60*24)),ie=w.length>0?w.reduce((s,c)=>s+c.amount,0)/w.length:0;return{totalIncome:k,totalExpense:D,balance:se,savingsRate:ne,avgDailyExpense:le,avgTransactionAmount:ie,topExpenseCategories:te,topIncomeCategories:re,monthlyTrend:L,transactionCount:w.length,periodLabel:x,startDate:n,endDate:m}},[l,x,i,b,j]);return f.useEffect(()=>{C(T)},[T]),e.jsxs("div",{style:{padding:h?"1rem":"2rem",maxWidth:"1200px",margin:"0 auto",minHeight:"100vh",color:"var(--text-primary)"},children:[e.jsxs(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between flex-wrap gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-dark fw-bold mb-2 d-flex align-items-center gap-2",children:[e.jsx(he,{size:28}),t("analytics.title")]}),e.jsx("p",{className:"text-muted mb-0",children:t("analytics.subtitle")})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(E.Select,{value:x,onChange:a=>v(a.target.value),style:{maxWidth:200,display:"inline-block"},children:[e.jsx("option",{value:"month",children:t("analytics.thisMonth")}),e.jsx("option",{value:"lastMonth",children:t("analytics.lastMonth")}),e.jsx("option",{value:"last3Months",children:t("analytics.last3Months")}),e.jsx("option",{value:"year",children:t("analytics.thisYear")}),e.jsx("option",{value:"custom",children:t("analytics.custom")})]}),x==="custom"&&e.jsxs("div",{className:"d-inline-flex align-items-center gap-2 ms-3",children:[e.jsx(E.Label,{className:"mb-0 small",children:t("analytics.from")}),e.jsx(E.Control,{type:"date",size:"sm",value:j.from,onChange:a=>N(n=>({...n,from:a.target.value})),style:{minWidth:120}}),e.jsx(E.Label,{className:"mb-0 small",children:t("analytics.to")}),e.jsx(E.Control,{type:"date",size:"sm",value:j.to,onChange:a=>N(n=>({...n,to:a.target.value})),style:{minWidth:120}})]})]})]}),d&&e.jsxs(V,{variant:"info",className:"border-0 mb-4",style:{borderRadius:"2rem",backgroundColor:"rgba(13, 202, 240, 0.1)",border:"1px solid rgba(13, 202, 240, 0.2)"},children:[e.jsxs(V.Heading,{className:"h6 fw-bold text-info",children:["ðŸŽ¯ ",t("analytics.demoMode")]}),e.jsx("p",{className:"mb-0",children:t("analytics.demoDescription",{current:l.length,max:o})})]})]}),e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"mb-5",children:e.jsx(Y,{className:"g-4",children:P.map((a,n)=>e.jsx(M,{xs:12,sm:6,lg:3,children:e.jsx(p,{className:"mb-4 shadow-sm glass-card analytics-glass",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.92) 0%, rgba(245,245,255,0.82) 100%)",backdropFilter:"blur(24px)",WebkitBackdropFilter:"blur(24px)",border:"1.5px solid rgba(255,255,255,0.35)",boxShadow:"0 8px 32px rgba(0,0,0,0.10)",borderRadius:"22px",transition:"transform 0.18s cubic-bezier(.4,2,.6,1), box-shadow 0.18s cubic-bezier(.4,2,.6,1)"},onMouseEnter:m=>{m.currentTarget.style.transform="translateY(-2px) scale(1.025)",m.currentTarget.style.boxShadow="0 12px 36px rgba(59,130,246,0.13)"},onMouseLeave:m=>{m.currentTarget.style.transform="none",m.currentTarget.style.boxShadow="0 8px 32px rgba(0,0,0,0.10)"},children:e.jsxs(p.Body,{className:"p-4 text-center",children:[e.jsx("div",{className:"rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px",backgroundColor:a.color+"20",color:a.color},children:a.icon}),e.jsx("h5",{className:"fw-bold text-dark mb-1",children:a.formatter(a.value)}),e.jsx("p",{className:"text-muted small mb-0",children:a.title})]})})},n))})}),e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"mb-5",children:e.jsxs(Y,{className:"g-4",children:[e.jsx(M,{xs:12,lg:6,children:e.jsx(p,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(p.Body,{className:"p-4",children:[e.jsxs("h5",{className:"fw-bold text-dark mb-4 d-flex align-items-center gap-2",children:[e.jsx(J,{className:"text-danger",size:20}),t("analytics.topExpenseCategories")]}),r.topExpenseCategories?.length>0?e.jsx("div",{className:"d-flex flex-column gap-3",children:r.topExpenseCategories.map((a,n)=>e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("div",{className:"text-center",style:{minWidth:"40px"},children:e.jsx("div",{style:{fontSize:"24px"},children:a.emoji})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsx("span",{className:"fw-medium text-dark",children:a.label}),e.jsx("span",{className:"text-danger fw-bold",children:y(a.amount)})]}),e.jsx(H,{now:a.percentage,style:{height:"6px",borderRadius:"3px"},className:"mb-1"}),e.jsxs("small",{className:"text-muted",children:[a.percentage.toFixed(1),"% ",t("analytics.ofTotal")]})]})]},n))}):e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(q,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{children:t("analytics.noExpenseData")})]})]})})}),e.jsx(M,{xs:12,lg:6,children:e.jsx(p,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(p.Body,{className:"p-4",children:[e.jsxs("h5",{className:"fw-bold text-dark mb-4 d-flex align-items-center gap-2",children:[e.jsx(_,{className:"text-success",size:20}),t("analytics.topIncomeCategories")]}),r.topIncomeCategories?.length>0?e.jsx("div",{className:"d-flex flex-column gap-3",children:r.topIncomeCategories.map((a,n)=>e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("div",{className:"text-center",style:{minWidth:"40px"},children:e.jsx("div",{style:{fontSize:"24px"},children:a.emoji})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsx("span",{className:"fw-medium text-dark",children:a.label}),e.jsx("span",{className:"text-success fw-bold",children:y(a.amount)})]}),e.jsx(H,{now:a.percentage,variant:"success",style:{height:"6px",borderRadius:"3px"},className:"mb-1"}),e.jsxs("small",{className:"text-muted",children:[a.percentage.toFixed(1),"% ",t("analytics.ofTotal")]})]})]},n))}):e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(q,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{children:t("analytics.noIncomeData")})]})]})})})]})}),e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"mb-5",children:e.jsx(p,{className:"border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(p.Body,{className:"p-4",children:[e.jsxs("h5",{className:"fw-bold text-dark mb-4 d-flex align-items-center gap-2",children:[e.jsx($,{className:"text-primary",size:20}),t("analytics.monthlyTrend")]}),r.monthlyTrend?.length>0?e.jsx("div",{className:"row g-2",children:r.monthlyTrend.map((a,n)=>e.jsx("div",{className:"col-6 col-md-4 col-lg-2",children:e.jsxs("div",{className:"text-center p-3 rounded-3",style:{backgroundColor:a.balance>=0?"var(--pastel-mint)":"var(--pastel-coral)",border:`1px solid ${a.balance>=0?"var(--accent-success)":"var(--accent-error)"}20`},children:[e.jsx("div",{className:"fw-bold text-dark small mb-1",children:a.month}),e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-1 mb-1",children:[e.jsx(be,{size:12,className:"text-success"}),e.jsx("small",{className:"text-success fw-medium",children:y(a.income)})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-1 mb-1",children:[e.jsx(ue,{size:12,className:"text-danger"}),e.jsx("small",{className:"text-danger fw-medium",children:y(a.expense)})]}),e.jsx("div",{className:`fw-bold small ${a.balance>=0?"text-success":"text-danger"}`,children:y(a.balance)})]})},n))}):e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx($,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{children:t("analytics.insufficientData")})]})]})})}),e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:e.jsxs(Y,{className:"g-4",children:[e.jsx(M,{xs:12,md:4,children:e.jsx(p,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(p.Body,{className:"p-4 text-center",children:[e.jsx(ge,{className:"text-primary mb-3",size:32}),e.jsx("h5",{className:"fw-bold text-dark mb-2",children:t("analytics.avgDailyExpense")}),e.jsx("div",{className:"fw-bold text-primary",style:{fontSize:"1.5rem"},children:y(r.avgDailyExpense||0)}),e.jsx("small",{className:"text-muted",children:t("analytics.inSelectedPeriod")})]})})}),e.jsx(M,{xs:12,md:4,children:e.jsx(p,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(p.Body,{className:"p-4 text-center",children:[e.jsx(K,{className:"text-warning mb-3",size:32}),e.jsx("h5",{className:"fw-bold text-dark mb-2",children:t("analytics.avgTransaction")}),e.jsx("div",{className:"fw-bold text-warning",style:{fontSize:"1.5rem"},children:y(r.avgTransactionAmount||0)}),e.jsx("small",{className:"text-muted",children:t("analytics.avgTransactionDescription")})]})})}),e.jsx(M,{xs:12,md:4,children:e.jsx(p,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(p.Body,{className:"p-4 text-center",children:[e.jsx($,{className:"text-info mb-3",size:32}),e.jsx("h5",{className:"fw-bold text-dark mb-2",children:t("analytics.totalTransactions")}),e.jsx("div",{className:"fw-bold text-info",style:{fontSize:"1.5rem"},children:r.transactionCount||0}),e.jsx("small",{className:"text-muted",children:t("analytics.inSelectedPeriod")})]})})})]})})]})},Ae=oe.memo(De);export{Ae as default};
