import{r as o,R as Ne,e as Ce,f as Te,b as we,a as De,j as e,B as j,g as J,l as Me,m as Se,n as ke,A as Le,o as w,p as Fe,q as Re}from"./index-DDDRuhU4.js";import{T as Ee,D as Ae,a as Ie,b as Oe,c as ze,d as Pe,e as _e}from"./TransactionModal-DxMNp3y3.js";import{t as qe,a as M,n as Be,s as V,i as Qe,S as D,b as z,f as X}from"./statsUtils-DwYTtLhi.js";import{u as Ue}from"./categories-BYj2ZsvF.js";import{I as He}from"./label-CB9dIS9Y.js";import{u as $e}from"./useDateRange-D3xv0VMp.js";import{f as P,i as We,e as Ge}from"./it-BgdBH8Y4.js";function Ke(r,d,i){const x=qe(r,i?.in);return isNaN(d)?M(r,NaN):(x.setDate(x.getDate()+d),x)}function Z(r){return M(r,Date.now())}function ee(r,d,i){const[x,h]=Be(i?.in,r,d);return+V(x)==+V(h)}function Ye(r,d){return ee(M(r,r),Z(r))}function Je(r,d,i){return Ke(r,-1,i)}function Ve(r,d){return ee(M(r,r),Je(Z(r)))}const Xe=(r,d)=>{const[i,x]=o.useState(""),[h,u]=o.useState("all"),[p,S]=o.useState("all");return{filteredTransactions:o.useMemo(()=>{if(!r||r.length===0)return[];const{startDate:b,endDate:N}=d;return[...r].sort((m,g)=>g.date-m.date).filter(m=>{if(b&&N&&(!m.date||!Qe(m.date,{start:b,end:N})))return!1;if(i){const g=i.toLowerCase(),f=m.description.toLowerCase().includes(g),v=m.category.toLowerCase().includes(g);if(!f&&!v)return!1}return!(h!=="all"&&m.category!==h||p!=="all"&&m.type!==p)})},[r,d,i,h,p]),searchTerm:i,setSearchTerm:x,selectedCategory:h,setSelectedCategory:u,selectedType:p,setSelectedType:S}},Ze=()=>{const{currentUser:r,loading:d}=Ce(),{transactions:i,loading:x,deleteTransaction:h,isDemo:u,canAddMoreTransactions:p,maxTransactions:S,fetchAllTransactions:_,getTotalTransactionCount:b}=Te(),{expenseCategories:N,incomeCategories:k}=Ue(),[m,g]=o.useState(null),[f,v]=o.useState(null),[te,L]=o.useState(!1),[T,se]=o.useState(!1),[c,F]=o.useState([]),[R,q]=o.useState(!1),[E,ae]=o.useState(!0),[A,I]=o.useState(0),{period:ne,setPeriod:re,startDate:ie,endDate:le}=$e("monthly");o.useEffect(()=>{(async()=>{if(r&&!u){const n=await b();I(n)}else u&&I(i.length)})()},[r,u,b,i]),o.useEffect(()=>{i.length>0&&F(t=>{const n=new Set(t.map(l=>l.id)),s=i.filter(l=>!n.has(l.id));return c.length===0||c.length<=i.length?i.sort((l,y)=>y.date-l.date):[...s,...t].sort((l,y)=>y.date-l.date)})},[i]);const B=async()=>{q(!0);const t=await _();F(t),I(t.length),ae(!1),q(!1)},Q=o.useRef(null);o.useEffect(()=>{const t=new IntersectionObserver(s=>{s[0].isIntersecting&&E&&!R&&!u&&c.length>0&&A>c.length&&B()},{threshold:.1,rootMargin:"100px"}),n=Q.current;return n&&t.observe(n),()=>{n&&t.unobserve(n)}},[E,R,u,c.length,A,B]);const{filteredTransactions:oe,searchTerm:U,setSearchTerm:ce,selectedCategory:H,setSelectedCategory:de,selectedType:$,setSelectedType:ue}=Xe(c.length>0?c:i,{startDate:ie,endDate:le}),{t:a,i18n:O}=we(),me=De({maxWidth:768}),xe=d||x&&c.length===0,C=o.useMemo(()=>a("dashboard.motivationalQuotes",{returnObjects:!0}),[a]),[he,fe]=o.useState("");o.useEffect(()=>{C&&C.length>0&&fe(C[Math.floor(Math.random()*C.length)])},[C]);const W=t=>t==="it"?We:Ge,G=t=>{const n=O.language||"it";if(Ye(t))return a("transactions.today");if(Ve(t))return a("transactions.yesterday");const s=W(n);return P(t,n==="it"?"d MMMM yyyy":"MMMM d, yyyy",{locale:s})},pe=t=>{const n={};return t.forEach(s=>{const l=s.date,y=P(l,"yyyy-MM-dd");n[y]||(n[y]={date:l,displayDate:G(l),transactions:[]}),n[y].transactions.push(s)}),Object.values(n).sort((s,l)=>l.date-s.date)},ge=t=>{const s=[...N,...k].find(l=>l.value===t);return s?s.label.split(" ")[0]:"ðŸ’¸"},K=t=>{const s=[...N,...k].find(l=>l.value===t);return s?s.label:t},ye=o.useCallback(async t=>{v(t)},[]),je=o.useCallback(async()=>{f&&(await h(f)&&v(null),F(n=>n.filter(s=>s.id!==f)))},[f,h]),ve=[...new Set(c.length>0?c.map(t=>t.category):i.map(t=>t.category))],be=[{value:"daily",label:a("transactions.filters.today")},{value:"weekly",label:a("transactions.filters.week")},{value:"monthly",label:a("transactions.filters.month")},{value:"annually",label:a("transactions.filters.year")},{value:"all",label:a("transactions.filters.all")}];if(xe)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(D,{height:120,borderRadius:16}),e.jsx(D,{height:120,borderRadius:16})]}),[...Array(4)].map((t,n)=>e.jsxs("div",{className:"space-y-3",children:[e.jsx(D,{width:140,height:20}),e.jsx(D,{height:72,borderRadius:18})]},n))]});if(!r&&!u)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:a("transactions.accessRequired")}),e.jsx("p",{className:"text-muted-foreground",children:a("transactions.loginRequired")})]})});const Y=pe(oe);return e.jsxs("div",{className:"page-shell -mt-6 pt-0",children:[e.jsxs("div",{className:"sticky top-0 z-20 rounded-2xl border border-border bg-card/90 backdrop-blur-md p-3 md:p-4 shadow-md",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-bold flex items-center gap-2",children:["ðŸ’³ ",a("transactions.title")]}),e.jsx("div",{className:"text-primary text-sm italic",children:he})]}),e.jsxs(j,{onClick:()=>L(!0),disabled:u&&!p,className:"gap-2",children:[e.jsx(J,{}),!me&&a("addTransaction")]})]}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Me,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx(He,{className:"pl-10",placeholder:a("searchTransactions"),value:U,onChange:t=>ce(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row",children:[e.jsx(z,{value:ne,onChange:t=>re(t.target.value),className:"md:flex-1",children:be.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsxs(j,{variant:T?"default":"outline",size:"sm",onClick:()=>se(!T),className:"w-full md:w-auto gap-2",children:[e.jsx(Se,{}),a(T?"transactions.filters.hide":"transactions.filters.show")]})]}),u&&e.jsxs("div",{className:"rounded-xl border border-primary/20 bg-primary/5 px-3 py-2 text-sm text-primary flex items-center gap-2",children:[e.jsxs(ke,{variant:"secondary",children:[i.filter(t=>!t.isSample).length,"/",S]}),e.jsx("span",{children:a("transactions.demoMode")})]}),e.jsx(Le,{children:T&&e.jsxs(w.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"grid gap-3 md:grid-cols-2",children:[e.jsxs(z,{value:$,onChange:t=>ue(t.target.value),children:[e.jsx("option",{value:"all",children:a("transactions.filters.allTypes")}),e.jsx("option",{value:"income",children:a("income")}),e.jsx("option",{value:"expense",children:a("expense")})]}),e.jsxs(z,{value:H,onChange:t=>de(t.target.value),children:[e.jsx("option",{value:"all",children:"Categorie"}),ve.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]})]})})]})]}),e.jsxs("div",{className:"space-y-4 pb-6 pt-3",children:[Y.length>0?Y.map((t,n)=>e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.05},className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-px flex-1 bg-border"}),e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:t.displayDate}),e.jsx("div",{className:"h-px flex-1 bg-border"})]}),e.jsx("div",{className:"space-y-2",children:t.transactions.map(s=>e.jsxs(w.div,{initial:{opacity:0,x:-12},animate:{opacity:1,x:0},className:"flex items-center justify-between rounded-2xl border border-border bg-card/80 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`flex h-11 w-11 items-center justify-center rounded-full ${s.type==="income"?"bg-emerald-500/10 text-emerald-600":"bg-rose-500/10 text-rose-600"}`,children:s.type==="income"?"ðŸ’°":ge(s.category)}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-base font-semibold leading-tight",children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:P(s.date,O.language==="it"?"dd MMM yyyy":"MMM dd, yyyy",{locale:W(O.language)})}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:K(s.category)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`text-base font-bold ${s.type==="income"?"text-emerald-600":"text-rose-600"}`,children:[s.type==="income"?"+":"-",X(s.amount)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{size:"sm",variant:"ghost",className:"h-9 w-9 p-0",onClick:l=>{l.stopPropagation(),g(s)},children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx(j,{size:"sm",variant:"ghost",className:"h-9 w-9 p-0 text-destructive hover:text-destructive",onClick:l=>{l.stopPropagation(),ye(s.id)},children:e.jsx(Re,{className:"h-4 w-4"})})]})]})]},s.id))})]},t.date.toISOString())):e.jsxs(w.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"text-center py-10",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted text-2xl",children:"ðŸ’³"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:a("transactions.empty.title")}),e.jsx("p",{className:"text-muted-foreground",children:a(U||H!=="all"||$!=="all"?"transactions.empty.tryFilters":"transactions.empty.addFirst")}),e.jsxs(j,{className:"mt-4 gap-2",onClick:()=>L(!0),disabled:u&&!p,children:[e.jsx(J,{}),a("addTransaction")]})]}),E&&!u&&c.length>0&&A>c.length&&e.jsx("div",{ref:Q,className:"flex justify-center py-6",children:R&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),a("loading")]})})]}),e.jsx(Ee,{show:te||!!m,onClose:()=>{L(!1),g(null)},transaction:m}),e.jsx(Ae,{open:!!f,onOpenChange:t=>!t&&v(null),children:e.jsxs(Ie,{children:[e.jsxs(Oe,{children:[e.jsx(ze,{children:a("confirmDelete")}),e.jsx(Pe,{children:a("transactions.deleteConfirm")})]}),(()=>{const t=c.find(n=>n.id===f)||i.find(n=>n.id===f);return t?e.jsxs("div",{className:"py-4 space-y-1",children:[e.jsx("div",{className:"font-bold text-foreground",children:t.description}),e.jsxs("div",{className:"text-muted-foreground text-sm",children:[G(t.date)," â€¢"," ",K(t.category)]}),e.jsxs("div",{className:`font-semibold ${t.type==="income"?"text-emerald-600":"text-rose-600"}`,children:[t.type==="income"?"+":"-",X(t.amount)]})]}):null})(),e.jsxs(_e,{className:"gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>v(null),children:a("cancel")}),e.jsx(j,{variant:"destructive",onClick:je,children:a("transactions.deleteConfirm")})]})]})})]})},lt=Ne.memo(Ze);export{lt as default};
