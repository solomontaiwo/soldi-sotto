import{r as M,u as ie,j as e,c as K,b as le,e as ne,Y as H,X as Q,n as L,ad as oe,m as D,ae as ce,B as de,af as me,a0 as _,ag as I,ah as xe,ai as pe,aj as be}from"./index-Bjk7Il94.js";import{f as g}from"./formatCurrency-DQxE0pTn.js";import{u as he}from"./categories-ttqCixUt.js";import{t as E,c as G,a as ue,f as ge,i as je}from"./it-CJeQdO6M.js";import{m as fe,F as ye}from"./Form-DjiPExJX.js";import{A as V}from"./Alert-rTvYwIdw.js";import{R as P}from"./Row-BeBAP0Rg.js";import{C}from"./Col-Bo0QpJom.js";import{C as x}from"./Card-92M1dKRR.js";import{s as R,e as B,a as Ne}from"./endOfYear-DWwhox6z.js";const X=1e3;function ve(c,r,o){const i=(c-r)/(o-r)*100;return Math.round(i*X)/X}function q({min:c,now:r,max:o,label:i,visuallyHidden:b,striped:m,animated:p,className:y,style:t,variant:v,bsPrefix:f,...w},F){return e.jsx("div",{ref:F,...w,role:"progressbar",className:K(y,`${f}-bar`,{[`bg-${v}`]:v,[`${f}-bar-animated`]:p,[`${f}-bar-striped`]:p||m}),style:{width:`${ve(r,c,o)}%`,...t},"aria-valuenow":r,"aria-valuemin":c,"aria-valuemax":o,children:b?e.jsx("span",{className:"visually-hidden",children:i}):i})}const O=M.forwardRef(({isChild:c=!1,...r},o)=>{const i={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...r};if(i.bsPrefix=ie(i.bsPrefix,"progress"),c)return q(i,o);const{min:b,now:m,max:p,label:y,visuallyHidden:t,striped:v,animated:f,bsPrefix:w,variant:F,className:a,children:n,...d}=i;return e.jsx("div",{ref:o,...d,className:K(a,w),children:n?fe(n,j=>M.cloneElement(j,{isChild:!0})):q({min:b,now:m,max:p,label:y,visuallyHidden:t,striped:v,animated:f,bsPrefix:w,variant:F},o)})});O.displayName="ProgressBar";function we(c,r,o){const i=E(c,o?.in);if(isNaN(r))return G(c,NaN);if(!r)return i;const b=i.getDate(),m=G(c,i.getTime());m.setMonth(i.getMonth()+r+1,0);const p=m.getDate();return b>=p?m:(i.setFullYear(m.getFullYear(),m.getMonth(),b),i)}function J(c,r,o){const i=+E(c,o?.in),[b,m]=[+E(r.start,o?.in),+E(r.end,o?.in)].sort((p,y)=>p-y);return i>=b&&i<=m}function S(c,r,o){return we(c,-r,o)}const Ee=()=>{const{isDemo:c,transactions:r,maxTransactions:o}=le(),{expenseCategories:i,incomeCategories:b}=he(),m=ne({maxWidth:768}),[p,y]=M.useState("thisMonth"),[t,v]=M.useState({}),f=M.useMemo(()=>{if(!r.length)return{};const a=new Date;let n,d;switch(p){case"thisMonth":n=R(a),d=B(a);break;case"lastMonth":{const s=S(a,1);n=R(s),d=B(s);break}case"thisYear":n=ue(a),d=Ne(a);break;case"last3Months":n=R(S(a,2)),d=B(a);break;default:n=R(a),d=B(a)}const j=r.filter(s=>{const l=s.date.toDate?s.date.toDate():new Date(s.date);return J(l,{start:n,end:d})}),N=j.filter(s=>s.type==="income").reduce((s,l)=>s+l.amount,0),k=j.filter(s=>s.type==="expense").reduce((s,l)=>s+l.amount,0),Z=N-k,A={},W={};j.forEach(s=>{s.type==="expense"?A[s.category]=(A[s.category]||0)+s.amount:W[s.category]=(W[s.category]||0)+s.amount});const ee=Object.entries(A).sort(([,s],[,l])=>l-s).slice(0,5).map(([s,l])=>{const h=i.find(z=>z.value===s);return{category:s,amount:l,percentage:k>0?l/k*100:0,label:h?h.label:s,emoji:h?h.label.split(" ")[0]:"ðŸ’¸"}}),ae=Object.entries(W).sort(([,s],[,l])=>l-s).slice(0,5).map(([s,l])=>{const h=b.find(z=>z.value===s);return{category:s,amount:l,percentage:N>0?l/N*100:0,label:h?h.label:s,emoji:h?h.label.split(" ")[0]:"ðŸ’°"}}),Y=[];for(let s=5;s>=0;s--){const l=R(S(a,s)),h=B(S(a,s)),z=r.filter(u=>{const T=u.date.toDate?u.date.toDate():new Date(u.date);return J(T,{start:l,end:h})}),$=z.filter(u=>u.type==="income").reduce((u,T)=>u+T.amount,0),U=z.filter(u=>u.type==="expense").reduce((u,T)=>u+T.amount,0);Y.push({month:ge(l,"MMM yyyy",{locale:je}),income:$,expense:U,balance:$-U})}const se=N>0?(N-k)/N*100:0,te=k/Math.max(1,(d-n)/(1e3*60*60*24)),re=j.length>0?j.reduce((s,l)=>s+l.amount,0)/j.length:0;return{totalIncome:N,totalExpense:k,balance:Z,savingsRate:se,avgDailyExpense:te,avgTransactionAmount:re,topExpenseCategories:ee,topIncomeCategories:ae,monthlyTrend:Y,transactionCount:j.length,periodLabel:p,startDate:n,endDate:d}},[r,p,i,b]);M.useEffect(()=>{v(f)},[f]);const w=[{value:"thisMonth",label:"Questo Mese"},{value:"lastMonth",label:"Mese Scorso"},{value:"last3Months",label:"Ultimi 3 Mesi"},{value:"thisYear",label:"Quest'Anno"}],F=[{title:"Entrate Totali",value:t.totalIncome||0,icon:e.jsx(H,{size:24}),color:"var(--accent-success)",bgColor:"var(--pastel-mint)",formatter:g},{title:"Uscite Totali",value:t.totalExpense||0,icon:e.jsx(Q,{size:24}),color:"var(--accent-error)",bgColor:"var(--pastel-coral)",formatter:g},{title:"Bilancio",value:t.balance||0,icon:e.jsx(L,{size:24}),color:t.balance>=0?"var(--accent-success)":"var(--accent-error)",bgColor:t.balance>=0?"var(--pastel-mint)":"var(--pastel-coral)",formatter:g},{title:"Tasso Risparmio",value:t.savingsRate||0,icon:e.jsx(oe,{size:24}),color:t.savingsRate>=20?"var(--accent-success)":t.savingsRate>=10?"var(--accent-warning)":"var(--accent-error)",bgColor:t.savingsRate>=20?"var(--pastel-mint)":t.savingsRate>=10?"var(--pastel-cream)":"var(--pastel-coral)",formatter:a=>`${a.toFixed(1)}%`}];return e.jsxs("div",{style:{padding:m?"1rem":"2rem",maxWidth:"1200px",margin:"0 auto",minHeight:"100vh",color:"var(--text-primary)"},children:[e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between flex-wrap gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-dark fw-bold mb-2 d-flex align-items-center gap-2",children:[e.jsx(ce,{size:28}),"Analytics & Insights"]}),e.jsx("p",{className:"text-muted mb-0",children:"Analizza le tue abitudini finanziarie e scopri pattern nascosti"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(ye.Select,{value:p,onChange:a=>y(a.target.value),style:{borderRadius:"12px",border:"1px solid rgba(0,0,0,0.1)",backgroundColor:"rgba(255,255,255,0.9)",minWidth:"150px"},children:w.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsxs(de,{variant:"outline-primary",onClick:()=>alert("FunzionalitÃ  di export in arrivo!"),className:"d-flex align-items-center gap-2",style:{borderRadius:"12px",backgroundColor:"rgba(255,255,255,0.9)",border:"1px solid rgba(13,110,253,0.2)"},children:[e.jsx(me,{size:16}),!m&&"Export"]})]})]}),c&&e.jsxs(V,{variant:"info",className:"border-0 mb-4",style:{borderRadius:"2rem",backgroundColor:"rgba(13, 202, 240, 0.1)",border:"1px solid rgba(13, 202, 240, 0.2)"},children:[e.jsx(V.Heading,{className:"h6 fw-bold text-info",children:"ðŸŽ¯ ModalitÃ  Demo Attiva"}),e.jsxs("p",{className:"mb-0",children:["Visualizzi analytics demo con ",r.length,"/",o," transazioni. Registrati per analytics complete e storiche!"]})]})]}),e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"mb-5",children:e.jsx(P,{className:"g-4",children:F.map((a,n)=>e.jsx(C,{xs:12,sm:6,lg:3,children:e.jsx(x,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)",transition:"all 0.3s ease"},onMouseEnter:d=>{d.currentTarget.style.transform="translateY(-3px)",d.currentTarget.style.boxShadow="0 12px 35px rgba(0, 0, 0, 0.15)"},onMouseLeave:d=>{d.currentTarget.style.transform="translateY(0)",d.currentTarget.style.boxShadow=""},children:e.jsxs(x.Body,{className:"p-4 text-center",children:[e.jsx("div",{className:"rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px",backgroundColor:a.color+"20",color:a.color},children:a.icon}),e.jsx("h5",{className:"fw-bold text-dark mb-1",children:a.formatter(a.value)}),e.jsx("p",{className:"text-muted small mb-0",children:a.title})]})})},n))})}),e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"mb-5",children:e.jsxs(P,{className:"g-4",children:[e.jsx(C,{xs:12,lg:6,children:e.jsx(x,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(x.Body,{className:"p-4",children:[e.jsxs("h5",{className:"fw-bold text-dark mb-4 d-flex align-items-center gap-2",children:[e.jsx(Q,{className:"text-danger",size:20}),"Top Categorie Spesa"]}),t.topExpenseCategories?.length>0?e.jsx("div",{className:"d-flex flex-column gap-3",children:t.topExpenseCategories.map((a,n)=>e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("div",{className:"text-center",style:{minWidth:"40px"},children:e.jsx("div",{style:{fontSize:"24px"},children:a.emoji})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsx("span",{className:"fw-medium text-dark",children:a.label}),e.jsx("span",{className:"text-danger fw-bold",children:g(a.amount)})]}),e.jsx(O,{now:a.percentage,style:{height:"6px",borderRadius:"3px"},className:"mb-1"}),e.jsxs("small",{className:"text-muted",children:[a.percentage.toFixed(1),"% del totale"]})]})]},n))}):e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(_,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{children:"Nessuna spesa nel periodo selezionato"})]})]})})}),e.jsx(C,{xs:12,lg:6,children:e.jsx(x,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(x.Body,{className:"p-4",children:[e.jsxs("h5",{className:"fw-bold text-dark mb-4 d-flex align-items-center gap-2",children:[e.jsx(H,{className:"text-success",size:20}),"Top Categorie Entrata"]}),t.topIncomeCategories?.length>0?e.jsx("div",{className:"d-flex flex-column gap-3",children:t.topIncomeCategories.map((a,n)=>e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("div",{className:"text-center",style:{minWidth:"40px"},children:e.jsx("div",{style:{fontSize:"24px"},children:a.emoji})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsx("span",{className:"fw-medium text-dark",children:a.label}),e.jsx("span",{className:"text-success fw-bold",children:g(a.amount)})]}),e.jsx(O,{now:a.percentage,variant:"success",style:{height:"6px",borderRadius:"3px"},className:"mb-1"}),e.jsxs("small",{className:"text-muted",children:[a.percentage.toFixed(1),"% del totale"]})]})]},n))}):e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(_,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{children:"Nessuna entrata nel periodo selezionato"})]})]})})})]})}),e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"mb-5",children:e.jsx(x,{className:"border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(x.Body,{className:"p-4",children:[e.jsxs("h5",{className:"fw-bold text-dark mb-4 d-flex align-items-center gap-2",children:[e.jsx(I,{className:"text-primary",size:20}),"Trend Ultimi 6 Mesi"]}),t.monthlyTrend?.length>0?e.jsx("div",{className:"row g-2",children:t.monthlyTrend.map((a,n)=>e.jsx("div",{className:"col-6 col-md-4 col-lg-2",children:e.jsxs("div",{className:"text-center p-3 rounded-3",style:{backgroundColor:a.balance>=0?"var(--pastel-mint)":"var(--pastel-coral)",border:`1px solid ${a.balance>=0?"var(--accent-success)":"var(--accent-error)"}20`},children:[e.jsx("div",{className:"fw-bold text-dark small mb-1",children:a.month}),e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-1 mb-1",children:[e.jsx(xe,{size:12,className:"text-success"}),e.jsx("small",{className:"text-success fw-medium",children:g(a.income)})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-1 mb-1",children:[e.jsx(pe,{size:12,className:"text-danger"}),e.jsx("small",{className:"text-danger fw-medium",children:g(a.expense)})]}),e.jsx("div",{className:`fw-bold small ${a.balance>=0?"text-success":"text-danger"}`,children:g(a.balance)})]})},n))}):e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx(I,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{children:"Dati insufficienti per mostrare il trend"})]})]})})}),e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:e.jsxs(P,{className:"g-4",children:[e.jsx(C,{xs:12,md:4,children:e.jsx(x,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(x.Body,{className:"p-4 text-center",children:[e.jsx(be,{className:"text-primary mb-3",size:32}),e.jsx("h5",{className:"fw-bold text-dark mb-2",children:"Spesa Media Giornaliera"}),e.jsx("div",{className:"fw-bold text-primary",style:{fontSize:"1.5rem"},children:g(t.avgDailyExpense||0)}),e.jsx("small",{className:"text-muted",children:"Nel periodo selezionato"})]})})}),e.jsx(C,{xs:12,md:4,children:e.jsx(x,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(x.Body,{className:"p-4 text-center",children:[e.jsx(L,{className:"text-warning mb-3",size:32}),e.jsx("h5",{className:"fw-bold text-dark mb-2",children:"Transazione Media"}),e.jsx("div",{className:"fw-bold text-warning",style:{fontSize:"1.5rem"},children:g(t.avgTransactionAmount||0)}),e.jsx("small",{className:"text-muted",children:"Importo medio per transazione"})]})})}),e.jsx(C,{xs:12,md:4,children:e.jsx(x,{className:"h-100 border-0 shadow-sm glass-card",style:{borderRadius:"2rem",background:"rgba(255,255,255,0.04)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.08)"},children:e.jsxs(x.Body,{className:"p-4 text-center",children:[e.jsx(I,{className:"text-info mb-3",size:32}),e.jsx("h5",{className:"fw-bold text-dark mb-2",children:"Transazioni Totali"}),e.jsx("div",{className:"fw-bold text-info",style:{fontSize:"1.5rem"},children:t.transactionCount||0}),e.jsx("small",{className:"text-muted",children:"Nel periodo selezionato"})]})})})]})})]})};export{Ee as default};
