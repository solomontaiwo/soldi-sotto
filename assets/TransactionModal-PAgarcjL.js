import{P as y,k as L,z as W,d as E,r as c,e as q,j as e,m as I,f as u,h as P,g as B,C as G,l as H}from"./index-DhPDyLgL.js";import{u as O}from"./categories-zf97789g.js";import{S as l}from"./formatCurrency-9CSuPI7Y.js";import{M as S}from"./Modal-CtcGh7Z4.js";import{F as i}from"./Form-DqIPrd7s.js";import{R as U}from"./Row-B3jRwWjC.js";import{C as M}from"./Col-BtPTxbzW.js";const Q=({show:d,onClose:p,onSubmit:m,transaction:s})=>{Q.propTypes={show:y.bool.isRequired,onClose:y.func.isRequired,onSubmit:y.func,transaction:y.object};const o=!!s,{addTransaction:C,updateTransaction:T}=L(),{expenseCategories:b,incomeCategories:f}=O(),R=W(),j=E({maxWidth:768}),[z,D]=c.useState([]),[v,N]=c.useState(!1),{t:r}=q(),[a,x]=c.useState({type:s?.type||"expense",amount:s?.amount?.toString()||"",description:s?.description||"",date:s?.date?(s.date instanceof Date?s.date:s.date?.toDate?.()||new Date(s.date)).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],category:s?.category||""}),w=c.useCallback(t=>{const n=t==="expense"?b:f;D(n),(!a.category||!n.find(g=>g.value===a.category))&&x(g=>({...g,category:n[0]?.value||""}))},[b,f,a.category]);c.useEffect(()=>{w(a.type)},[a.type,b,f]),c.useEffect(()=>{d&&!o&&x({type:"expense",amount:"",description:"",date:new Date().toISOString().split("T")[0],category:b[0]?.value||""}),d&&o&&s&&x({type:s.type,amount:s.amount.toString(),description:s.description,date:(s.date instanceof Date?s.date:s.date?.toDate?.()||new Date(s.date)).toISOString().split("T")[0],category:s.category})},[d,o,s]);const F=async t=>{t.preventDefault(),N(!0);try{let n=!1;o?n=await(m?m(a):T(s.id,{type:a.type,amount:parseFloat(a.amount),description:a.description,date:new Date(a.date),category:a.category})):n=await(m?m(a):C({type:a.type,amount:parseFloat(a.amount),description:a.description,date:new Date(a.date),category:a.category})),n&&p()}catch{R.error("Errore nella transazione")}finally{N(!1)}},h=(t,n)=>{x(g=>({...g,[t]:n}))},k=t=>{x(n=>({...n,type:t})),w(t)};return d?v?e.jsx(S,{show:d,onHide:p,centered:!0,size:"lg",backdrop:!0,className:"glass-modal",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(l,{height:24,width:180,style:{marginBottom:12}}),e.jsx(l,{height:18,width:120})]}),e.jsx("div",{className:"mb-3",children:e.jsx(l,{height:40,width:"100%",style:{borderRadius:12}})}),e.jsx("div",{className:"mb-3",children:e.jsx(l,{height:40,width:"100%",style:{borderRadius:12}})}),e.jsx("div",{className:"mb-3",children:e.jsx(l,{height:40,width:"100%",style:{borderRadius:12}})}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(l,{height:38,width:120,style:{borderRadius:20}}),e.jsx(l,{height:38,width:180,style:{borderRadius:20}})]})]})}):e.jsx(S,{show:d,onHide:p,centered:!0,size:"lg",backdrop:!0,className:"glass-modal",style:{},children:e.jsxs(I.div,{initial:{opacity:0,scale:.98,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.98,y:10},transition:{type:"spring",damping:28,stiffness:320,duration:.32},style:{background:document.documentElement.classList.contains("dark-theme")?"rgba(30,41,59,0.98)":"rgba(255,255,255,0.92)",backdropFilter:"blur(32px)",WebkitBackdropFilter:"blur(32px)",borderRadius:"28px",border:document.documentElement.classList.contains("dark-theme")?"1.5px solid #334155":"1px solid #e5e7eb",boxShadow:"0 8px 32px rgba(0,0,0,0.10)",width:"auto",maxHeight:"90vh",overflow:"hidden",position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-4 pb-0 w-100",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"fw-bold text-dark mb-1 d-flex align-items-center gap-3",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 197, 253, 0.15))",backdropFilter:"blur(10px)",border:"1px solid rgba(59, 130, 246, 0.2)"},children:o?"✏️":"⚡"}),r(o?"transactionModal.editTitle":"transactionModal.newTitle")]}),e.jsx("p",{className:"text-muted mb-0 ms-5 ps-3",style:{fontSize:"0.95rem"},children:r(o?"transactionModal.editSubtitle":"transactionModal.newSubtitle")})]}),e.jsx(u,{variant:"link",onClick:p,className:"p-0 d-flex align-items-center justify-content-center",style:{fontSize:"22px",width:"44px",height:"44px",borderRadius:"16px",background:"var(--glass-bg, rgba(255,255,255,0.6))",color:"var(--text-primary, #222)",border:"1px solid rgba(0, 0, 0, 0.08)",transition:"all 0.3s ease"},onMouseEnter:t=>{t.currentTarget.style.background="rgba(239, 68, 68, 0.15)",t.currentTarget.style.color="#dc3545",t.currentTarget.style.transform="scale(1.05)"},onMouseLeave:t=>{t.currentTarget.style.background="var(--glass-bg, rgba(255,255,255,0.6))",t.currentTarget.style.color="var(--text-primary, #222)",t.currentTarget.style.transform="scale(1)"},children:e.jsx("span",{style:{color:"inherit",fontWeight:700},children:"×"})})]}),e.jsxs("div",{className:"p-4 pt-3 w-100",style:{maxHeight:"calc(90vh - 120px)",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"rgba(0,0,0,0.2) transparent"},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(i.Label,{className:"fw-semibold text-dark mb-2 small",children:r("transactionModal.type")}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(u,{variant:a.type==="expense"?"danger":"outline-danger",onClick:()=>k("expense"),className:"flex-fill d-flex align-items-center justify-content-center gap-2 py-2",style:{borderRadius:"12px",fontWeight:"600",fontSize:"14px",background:a.type==="expense"?"linear-gradient(135deg, var(--accent-error), #c82333)":"rgba(255, 255, 255, 0.8)",border:a.type==="expense"?"none":"2px solid var(--accent-error)"},children:[e.jsx(P,{size:16}),r("transactionModal.expense")]}),e.jsxs(u,{variant:a.type==="income"?"success":"outline-success",onClick:()=>k("income"),className:"flex-fill d-flex align-items-center justify-content-center gap-2 py-2",style:{borderRadius:"12px",fontWeight:"600",fontSize:"14px",background:a.type==="income"?"linear-gradient(135deg, var(--accent-success), #157347)":"rgba(255, 255, 255, 0.8)",border:a.type==="income"?"none":"2px solid var(--accent-success)"},children:[e.jsx(B,{size:16}),r("transactionModal.income")]})]})]}),e.jsxs(i,{onSubmit:F,children:[e.jsxs(U,{className:"mb-3",children:[e.jsx(M,{xs:j?12:6,className:j?"mb-3":"",children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{className:"fw-semibold text-dark small mb-1",children:r("transactionModal.amount")}),e.jsx(i.Control,{type:"number",step:"0.01",min:"0",placeholder:r("transactionModal.amountPlaceholder"),value:a.amount,onChange:t=>h("amount",t.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"}})]})}),e.jsx(M,{xs:j?12:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{className:"fw-semibold text-dark small mb-1",children:r("transactionModal.date")}),e.jsx(i.Control,{type:"date",value:a.date,onChange:t=>h("date",t.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"}})]})})]}),e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{className:"fw-semibold text-dark small mb-1",children:r("transactionModal.description")}),e.jsx(i.Control,{type:"text",placeholder:r("transactionModal.descriptionPlaceholder"),value:a.description,onChange:t=>h("description",t.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"}})]}),e.jsxs(i.Group,{className:"mb-4",children:[e.jsx(i.Label,{className:"fw-semibold text-dark small mb-2",children:r("transactionModal.category")}),e.jsxs(i.Select,{value:a.category,onChange:t=>h("category",t.target.value),required:!0,className:"border-0",style:{height:"46px",borderRadius:"14px",fontSize:"15px",background:"rgba(255, 255, 255, 0.85)",border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",fontWeight:"500"},children:[e.jsx("option",{value:"",children:r("transactionModal.selectCategory")}),z.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(u,{type:"button",variant:"outline-secondary",onClick:p,className:"flex-fill py-2",style:{borderRadius:"12px",fontWeight:"500",fontSize:"14px",background:"rgba(255, 255, 255, 0.9)",border:"1px solid rgba(0, 0, 0, 0.15)"},children:r("transactionModal.cancel")}),e.jsx(u,{type:"submit",disabled:v||!a.amount||!a.description||!a.category,className:"flex-fill border-0 fw-semibold py-2",style:{borderRadius:"12px",fontSize:"14px",background:a.type==="expense"?"linear-gradient(135deg, var(--accent-error), #c82333)":"linear-gradient(135deg, var(--accent-success), #157347)",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.15)"},children:v?e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-1",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),r(o?"transactionModal.saving":"transactionModal.adding")]}):e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-1",children:[o?e.jsx(G,{size:16}):e.jsx(H,{size:16}),o?r("transactionModal.saveChanges"):r("transactionModal.addButton",{type:a.type==="expense"?r("transactionModal.expense"):r("transactionModal.income")})]})})]})]})]})]})}):null};export{Q as T};
